"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,o,i,n,l,s){var r,u=_ctor.default.findIndexOf(s,function(e){return o[i]===e});if(t===n)l&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var c=u-1;0<=c;c--)if(!1!==s[c].visible){r=s[c];break}o[i]=r||s[s.length-1]}else if(40===t){for(var a=u+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}o[i]=r||s[0]}else!o[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[i])},handleGlobalContextmenuEvent:function(e){var t=this.$refs,o=this.tId,i=this.editStore,n=this.contextMenu,l=this.ctxMenuStore,s=this.ctxMenuOpts,r=this.mouseConfig,u=this.mouseOpts,c=i.selected,a=["header","body","footer"];if(n){if(l.visible&&t.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();if(this._keyCtx){i="body",n={type:i,$grid:this.$xegrid,$table:this,keyboard:!0,columns:this.visibleColumn.slice(0),$event:e};if(r&&u.area){l=this.getActiveCellArea();if(l&&l.row&&l.column)return n.row=l.row,n.column=l.column,void this.openContextMenu(e,i,n)}else if(r&&u.selected&&c.row&&c.column)return n.row=c.row,n.column=c.column,void this.openContextMenu(e,i,n)}for(var d=0;d<a.length;d++){var h=a[d],f=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(h,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===o}),v={type:h,$grid:this.$xegrid,$table:this,columns:this.visibleColumn.slice(0),$event:e};if(f.flag){var g=f.targetElem,p=this.getColumnNode(g).item,f="".concat(h,"-");return Object.assign(v,{column:p,columnIndex:this.getColumnIndex(p),cell:g}),"body"===h&&(g=this.getRowNode(g.parentNode).item,f="",v.row=g,v.rowIndex=this.getRowIndex(g)),this.openContextMenu(e,h,v),void this.emitEvent("".concat(f,"cell-context-menu"),v,e)}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(h,"-wrapper"),function(e){return e.getAttribute("data-tid")===o}).flag)return void("cell"===s.trigger?e.preventDefault():this.openContextMenu(e,h,v))}}t.filterWrapper&&!_tools.DomTools.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},openContextMenu:function(t,e,o){var h,f=this,v=this.ctxMenuStore,i=this.ctxMenuOpts,e=i[e],g=i.visibleMethod;e&&(h=e.options,e.disabled?t.preventDefault():h&&h.length&&(o.options=h,this.preventEvent(t,"event.showMenu",o,null,function(){var n,l,s,r,u,c,i,e,a,d;!g||g(o,t)?(t.preventDefault(),f.updateZindex(),e=_tools.DomTools.getDomNode(),n=e.scrollTop,l=e.scrollLeft,s=e.visibleHeight,r=e.visibleWidth,u=t.clientY+n,c=t.clientX+l,i=function(){Object.assign(v,{args:o,visible:!0,list:h,selected:null,selectChild:null,showChild:!1,style:{zIndex:f.tZindex,top:"".concat(u,"px"),left:"".concat(c,"px")}}),f.$nextTick(function(){var e=f.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,i=_tools.DomTools.getAbsolutePos(e),e=i.boundingTop,i=i.boundingLeft+o-r;-10<e+t-s&&(v.style.top="".concat(Math.max(n+2,u-t-2),"px")),-10<i&&(v.style.left="".concat(Math.max(l+2,c-o-2),"px"))})},e=o.keyboard,a=o.row,d=o.column,e&&a&&d?f.scrollToRow(a,d).then(function(){var e=f.getCell(a,d),t=_tools.DomTools.getAbsolutePos(e),o=t.boundingTop,t=t.boundingLeft;u=o+n+Math.floor(e.offsetHeight/2),c=t+l+Math.floor(e.offsetWidth/2),i()}):i()):f.closeMenu()}))),this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,o){var r=e.currentTarget,i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=o)||(i.showChild=_tools.UtilTools.hasChildrenList(t),i.showChild&&this.$nextTick(function(){var e,t,o,i,n,l,s=r.nextElementSibling;s&&(i=(o=_tools.DomTools.getAbsolutePos(r)).boundingTop,n=o.boundingLeft,e=o.visibleHeight,l=o.visibleWidth,t=i+r.offsetHeight,i=o="",n+r.offsetWidth+s.offsetWidth>l-10&&(o="auto",i="".concat(r.offsetWidth,"px")),l=n="",t+s.offsetHeight>e-10&&(n="auto",l="0"),s.style.left=o,s.style.right=i,s.style.top=n,s.style.bottom=l)}))},ctxMenuMouseoutEvent:function(e,t){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){var o;t.disabled||t.children&&t.children.length||(o=_vXETable.default.menus.get(t.code),t=Object.assign({menu:t,$grid:this.$xegrid,$table:this,$event:e},this.ctxMenuStore.args),o&&o.call(this,t,e),this.emitEvent("context-menu-click",t,e),this.closeMenu())}}};exports.default=_default;