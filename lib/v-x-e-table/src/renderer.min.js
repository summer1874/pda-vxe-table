"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var inputEventTypes=["input","textarea","$input","$textarea"],defaultCompProps={transfer:!0};function isEmptyValue(e){return null==e||""===e}function getChangeEvent(e){return-1<inputEventTypes.indexOf(e.name)?"input":"change"}function parseDate(e,t){return e&&t.valueFormat?_ctor.default.toStringDate(e,t.valueFormat):e}function getFormatDate(e,t,n){var r=t.dateConfig,r=void 0===r?{}:r;return _ctor.default.toDateString(parseDate(e,t),r.labelFormat||n)}function getLabelFormatDate(e,t){return getFormatDate(e,t,_conf.default.i18n("vxe.input.date.labelFormat.".concat(t.type)))}function getDefaultComponentName(e){e=e.name;return"vxe-".concat(e.replace("$",""))}function handleConfirmFilter(e,t,n){e.$panel.changeOption({},t,n)}function getNativeAttrs(e){var t=e.name,e=e.attrs;return"input"===t&&(e=Object.assign({type:"text"},e)),e}function getCellEditFilterProps(e,t,n,r){t=t.$table.vSize;return _ctor.default.assign(t?{size:t}:{},defaultCompProps,r,e.props,{value:n})}function getItemProps(e,t,n,r){t=t.$form.vSize;return _ctor.default.assign(t?{size:t}:{},defaultCompProps,r,e.props,{value:n})}function getNativeOns(e,o){var e=e.nativeEvents,t={};return _ctor.default.objectEach(e,function(r,e){t[e]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.apply(void 0,[o].concat(t))}}),t}function getOns(e,o,t,r){var a=e.events,n="input",u=getChangeEvent(e),i=u===n,l={};return _ctor.default.objectEach(a,function(r,e){l[e]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.apply(void 0,[o].concat(t))}}),t&&(l[n]=function(e){t(e),a&&a[n]&&a[n](o,e),i&&r&&r(e)}),!i&&r&&(l[u]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.apply(void 0,t),a&&a[u]&&a[u].apply(a,[o].concat(t))}),l}function getEditOns(e,t){var n=t.$table,r=t.row,o=t.column;return getOns(e,t,function(e){_ctor.default.set(r,o.property,e)},function(){n.updateStatus(t)})}function getFilterOns(e,t,n){return getOns(e,t,function(e){n.data=e},function(){handleConfirmFilter(t,!_ctor.default.eqNull(n.data),n)})}function getItemOns(e,t){var n=t.$form,r=t.data,o=t.property;return getOns(e,t,function(e){_ctor.default.set(r,o,e)},function(){n.updateStatus(t)})}function isSyncCell(e,t){return e.immediate||"visible"===e.type||"cell"===t.$type}function getNativeEditOns(t,n){var r=n.$table,o=n.row,a=n.column,u=a.model;return getOns(t,n,function(e){e=e.target.value;isSyncCell(t,n)?_tools.UtilTools.setCellValue(o,a,e):(u.update=!0,u.value=e)},function(e){e=e.target.value;r.updateStatus(n,e)})}function getNativeFilterOns(e,t,n){return getOns(e,t,function(e){n.data=e.target.value},function(){handleConfirmFilter(t,!_ctor.default.eqNull(n.data),n)})}function getNativeItemOns(e,t){var n=t.$form,r=t.data,o=t.property;return getOns(e,t,function(e){e=e.target.value;_ctor.default.set(r,o,e)},function(){n.updateStatus(t)})}function nativeEditRender(e,t,n){var r=n.row,o=n.column,a=t.name,u=getNativeAttrs(t),o=isSyncCell(t,n)?_tools.UtilTools.getCellValue(r,o):o.model.value;return[e(a,{class:"vxe-default-".concat(a),attrs:u,domProps:{value:o},on:getNativeEditOns(t,n)})]}function defaultEditRender(e,t,n){var r=n.row,o=n.column,o=_tools.UtilTools.getCellValue(r,o);return[e(getDefaultComponentName(t),{props:getCellEditFilterProps(t,n,o),on:getEditOns(t,n),nativeOn:getNativeOns(t,n)})]}function defaultButtonEditRender(e,t,n){return[e("vxe-button",{props:getCellEditFilterProps(t,n),on:getOns(t,n),nativeOn:getNativeOns(t,n)})]}function defaultButtonsEditRender(t,e,n){return e.children.map(function(e){return defaultButtonEditRender(t,e,n)[0]})}function renderNativeOptgroups(n,r,o,a){var e=r.optionGroups,t=r.optionGroupProps,t=void 0===t?{}:t,u=t.options||"options",i=t.label||"label";return e.map(function(e,t){return n("optgroup",{key:t,domProps:{label:e[i]}},a(n,e[u],r,o))})}function renderNativeOptions(n,e,t,r){var o=t.optionProps,a=void 0===o?{}:o,u=r.row,o=r.column,i=a.label||"label",l=a.value||"value",d=a.disabled||"disabled",p=isSyncCell(t,r)?_tools.UtilTools.getCellValue(u,o):o.model.value;return e.map(function(e,t){return n("option",{key:t,attrs:{value:e[l],disabled:e[d]},domProps:{selected:e[l]==p}},e[i])})}function nativeFilterRender(n,r,o){var e=o.column,a=r.name,u=getNativeAttrs(r);return e.filters.map(function(e,t){return n(a,{key:t,class:"vxe-default-".concat(a),attrs:u,domProps:{value:e.data},on:getNativeFilterOns(r,o,e)})})}function defaultFilterRender(r,o,a){return a.column.filters.map(function(e,t){var n=e.data;return r(getDefaultComponentName(o),{key:t,props:getCellEditFilterProps(o,o,n),on:getFilterOns(o,a,e)})})}function handleFilterMethod(e){var t=e.option,n=e.row,e=e.column,t=t.data;return _ctor.default.get(n,e.property)==t}function nativeSelectEditRender(e,t,n){return[e("select",{class:"vxe-default-select",attrs:getNativeAttrs(t),on:getNativeEditOns(t,n)},t.optionGroups?renderNativeOptgroups(e,t,n,renderNativeOptions):renderNativeOptions(e,t.options,t,n))]}function defaultSelectEditRender(e,t,n){var r=n.row,o=n.column,a=t.options,u=t.optionProps,i=t.optionGroups,l=t.optionGroupProps,o=_tools.UtilTools.getCellValue(r,o);return[e(getDefaultComponentName(t),{props:getCellEditFilterProps(t,n,o,{options:a,optionProps:u,optionGroups:i,optionGroupProps:l}),on:getEditOns(t,n)})]}function getSelectCellValue(e,t){var r,n=t.row,o=t.column,a=e.props,t=void 0===a?{}:a,u=e.options,i=e.optionGroups,a=e.optionProps,a=void 0===a?{}:a,e=e.optionGroupProps,l=void 0===e?{}:e,o=_ctor.default.get(n,o.property),d=a.label||"label",p=a.value||"value";return isEmptyValue(o)?null:_ctor.default.map(t.multiple?o:[o],i?function(t){for(var e=l.options||"options",n=0;n<i.length&&!(r=_ctor.default.find(i[n][e],function(e){return e[p]==t}));n++);return r?r[d]:t}:function(t){return(r=_ctor.default.find(u,function(e){return e[p]==t}))?r[d]:t}).join(", ")}function nativeItemRender(e,t,n){var r=n.data,o=n.property,a=t.name,u=getNativeAttrs(t),o=_ctor.default.get(r,o);return[e(a,{class:"vxe-default-".concat(a),attrs:u,domProps:!u||"input"!==a||"submit"!==u.type&&"reset"!==u.type?{value:o}:null,on:getNativeItemOns(t,n)})]}function defaultItemRender(e,t,n){var r=n.data,o=n.property,o=_ctor.default.get(r,o);return[e(getDefaultComponentName(t),{props:getItemProps(t,n,o),on:getItemOns(t,n),nativeOn:getNativeOns(t,n)})]}function defaultButtonItemRender(e,t,n){return[e("vxe-button",{props:getItemProps(t,n),on:getOns(t,n),nativeOn:getNativeOns(t,n)})]}function defaultButtonsItemRender(t,e,n){return e.children.map(function(e){return defaultButtonItemRender(t,e,n)[0]})}function renderNativeFormOptions(n,e,t,r){var o=r.data,r=r.property,t=t.optionProps,t=void 0===t?{}:t,a=t.label||"label",u=t.value||"value",i=t.disabled||"disabled",l=_ctor.default.get(o,r);return e.map(function(e,t){return n("option",{key:t,attrs:{value:e[u],disabled:e[i]},domProps:{selected:e[u]==l}},e[a])})}function handleExportSelectMethod(e){var t=e.row,n=e.column;return e.options.original?_tools.UtilTools.getCellValue(t,n):getSelectCellValue(n.editRender||n.cellRender,e)}function defaultFormItemRadioAndCheckboxRender(n,e,t){var r=e.options,o=e.optionProps,a=void 0===o?{}:o,u=t.data,o=t.property,i=a.label||"label",l=a.value||"value",d=a.disabled||"disabled",o=_ctor.default.get(u,o),p=getDefaultComponentName(e);return[n("".concat(p,"-group"),{props:getItemProps(e,t,o),on:getItemOns(e,t),nativeOn:getNativeOns(e,t)},r.map(function(e,t){return n(p,{key:t,props:{label:e[l],content:e[i],disabled:e[d]}})}))]}var renderMap={input:{autofocus:"input",renderEdit:nativeEditRender,renderDefault:nativeEditRender,renderFilter:nativeFilterRender,filterMethod:handleFilterMethod,renderItem:nativeItemRender},textarea:{autofocus:"textarea",renderEdit:nativeEditRender,renderItem:nativeItemRender},select:{renderEdit:nativeSelectEditRender,renderDefault:nativeSelectEditRender,renderCell:function(e,t,n){return getSelectCellValue(t,n)},renderFilter:function(n,r,o){return o.column.filters.map(function(e,t){return n("select",{key:t,class:"vxe-default-select",attrs:getNativeAttrs(r),on:getNativeFilterOns(r,o,e)},r.optionGroups?renderNativeOptgroups(n,r,o,renderNativeOptions):renderNativeOptions(n,r.options,r,o))})},filterMethod:handleFilterMethod,renderItem:function(e,t,n){return[e("select",{class:"vxe-default-select",attrs:getNativeAttrs(t),on:getNativeItemOns(t,n)},t.optionGroups?renderNativeOptgroups(e,t,n,renderNativeFormOptions):renderNativeFormOptions(e,t.options,t,n))]},cellExportMethod:handleExportSelectMethod},$input:{autofocus:".vxe-input--inner",renderEdit:defaultEditRender,renderCell:function(e,t,n){var r=t.props,t=void 0===r?{}:r,r=n.row,n=n.column,n=_ctor.default.get(r,n.property);if(n)switch(t.type){case"date":case"week":case"month":case"year":n=getLabelFormatDate(n,t);break;case"float":n=_ctor.default.toFixedString(n,_ctor.default.toNumber(t.digits||_conf.default.input.digits))}return n},renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:handleFilterMethod,renderItem:defaultItemRender},$textarea:{autofocus:".vxe-textarea--inner",renderItem:defaultItemRender},$button:{renderDefault:defaultButtonEditRender,renderItem:defaultButtonItemRender},$buttons:{renderDefault:defaultButtonsEditRender,renderItem:defaultButtonsItemRender},$select:{autofocus:".vxe-input--inner",renderEdit:defaultSelectEditRender,renderDefault:defaultSelectEditRender,renderCell:function(e,t,n){return getSelectCellValue(t,n)},renderFilter:function(r,o,a){var e=a.column,u=o.options,i=o.optionProps,l=o.optionGroups,d=o.optionGroupProps,p=getNativeOns(o,a);return e.filters.map(function(e,t){var n=e.data;return r(getDefaultComponentName(o),{key:t,props:getCellEditFilterProps(o,a,n,{options:u,optionProps:i,optionGroups:l,optionGroupProps:d}),on:getFilterOns(o,a,e),nativeOn:p})})},filterMethod:handleFilterMethod,renderItem:function(e,t,n){var r=n.data,o=n.property,a=t.options,u=t.optionProps,i=t.optionGroups,l=t.optionGroupProps,o=_ctor.default.get(r,o);return[e(getDefaultComponentName(t),{props:getItemProps(t,n,o,{options:a,optionProps:u,optionGroups:i,optionGroupProps:l}),on:getItemOns(t,n),nativeOn:getNativeOns(t,n)})]},cellExportMethod:handleExportSelectMethod},$radio:{autofocus:".vxe-radio--input",renderItem:defaultFormItemRadioAndCheckboxRender},$checkbox:{autofocus:".vxe-checkbox--input",renderItem:defaultFormItemRadioAndCheckboxRender},$switch:{autofocus:".vxe-switch--button",renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderItem:defaultItemRender}},renderer={mixin:function(e){return _ctor.default.each(e,function(e,t){return renderer.add(t,e)}),renderer},get:function(e){return renderMap[e]||null},add:function(e,t){var n;return e&&t&&((n=renderMap[e])?Object.assign(n,t):renderMap[e]=t),renderer},delete:function(e){return delete renderMap[e],renderer}},_default=renderer;exports.default=renderer;