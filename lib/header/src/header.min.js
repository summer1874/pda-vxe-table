"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var cellType="header",_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,o=this.fixedType,e=e.elemStore,o="".concat(o||"main","-header-");e["".concat(o,"wrapper")]=t,e["".concat(o,"table")]=l.table,e["".concat(o,"colgroup")]=l.colgroup,e["".concat(o,"list")]=l.thead,e["".concat(o,"xSpace")]=l.xSpace,e["".concat(o,"repair")]=l.repair},render:function(x){var g=this,e=this._e,b=this.$parent,C=this.fixedType,t=this.headerColumn,l=this.fixedColumn,o=this.tableColumn,_=b.$listeners,r=b.tId,v=b.resizable,w=b.border,T=b.columnKey,n=b.headerRowClassName,$=b.headerCellClassName,i=b.headerRowStyle,z=b.headerCellStyle,P=b.showHeaderOverflow,S=b.headerAlign,M=b.align,D=b.highlightCurrentColumn,W=b.currentColumn,k=b.mouseConfig,I=b.scrollXLoad,R=b.overflowX,a=b.scrollbarWidth,A=b.getColumnIndex,H=b.sortOpts;return I&&C&&(o=l),x("div",{class:["vxe-table--header-wrapper",C?"fixed-".concat(C,"--wrapper"):"body--wrapper"],attrs:{"data-tid":r}},[C?e():x("div",{class:"vxe-body--x-space",ref:"xSpace"}),x("table",{class:"vxe-table--header",attrs:{"data-tid":r,cellspacing:0,cellpadding:0,border:0},ref:"table"},[x("colgroup",{ref:"colgroup"},o.map(function(e,t){return x("col",{attrs:{name:e.id},key:t})}).concat(a?[x("col",{attrs:{name:"col_gutter"}})]:[])),x("thead",{ref:"thead"},t.map(function(m,y){return x("tr",{class:["vxe-header--row",n?_ctor.default.isFunction(n)?n({$table:b,$rowIndex:y,fixed:C,type:cellType}):n:""],style:i?_ctor.default.isFunction(i)?i({$table:b,$rowIndex:y,fixed:C,type:cellType}):i:null},m.map(function(e,t){var l=e.showHeaderOverflow,o=e.headerAlign,r=e.align,n=e.headerClassName,i=e.children&&e.children.length,a=C?e.fixed!==C&&!i:e.fixed&&R,s=_ctor.default.isUndefined(l)||_ctor.default.isNull(l)?P:l,d=o||r||S||M,c="ellipsis"===s,u="title"===s,f=!0===s||"tooltip"===s,p=u||f||c,l={},o=e.filters&&e.filters.some(function(e){return e.checked}),r=A(e),s=b.getVTColumnIndex(e),h={$table:b,$rowIndex:y,column:e,columnIndex:r,$columnIndex:t,_columnIndex:s,fixed:C,type:cellType,isHidden:a,hasFilter:o};I&&!p&&(c=p=!0),(D||_["header-cell-click"]||k||"cell"===H.trigger)&&(l.click=function(e){return b.triggerHeaderCellClickEvent(e,h)}),_["header-cell-dblclick"]&&(l.dblclick=function(e){return b.triggerHeaderCellDBLClickEvent(e,h)}),k&&(l.mousedown=function(e){return b.triggerHeaderCellMousedownEvent(e,h)});r="seq"===e.type||"index"===e.type?"seq":e.type;return x("th",{class:["vxe-header--column",e.id,(_defineProperty(s={},"col--".concat(d),d),_defineProperty(s,"col--".concat(r),r),_defineProperty(s,"col--last",t===m.length-1),_defineProperty(s,"col--fixed",e.fixed),_defineProperty(s,"col--group",i),_defineProperty(s,"col--ellipsis",p),_defineProperty(s,"fixed--hidden",a),_defineProperty(s,"is--sortable",e.sortable),_defineProperty(s,"is--filter",!!e.filters),_defineProperty(s,"filter--active",o),_defineProperty(s,"col--current",W===e),s),_tools.UtilTools.getClass(n,h),_tools.UtilTools.getClass($,h)],attrs:{"data-colid":e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null},style:z?_ctor.default.isFunction(z)?z(h):z:null,on:l,key:T||i?e.id:t},[x("div",{class:["vxe-cell",{"c--title":u,"c--tooltip":f,"c--ellipsis":c}]},e.renderHeader(x,h)),!a&&!i&&(_ctor.default.isBoolean(e.resizable)?e.resizable:v)?x("div",{class:["vxe-resizable",{"is--line":!w||"none"===w}],on:{mousedown:function(e){return g.resizeMousedown(e,h)}}}):null])}).concat(a?[x("th",{class:"col--gutter"})]:[]))}))]),x("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var l=t.column,o=this.$parent,r=this.$el,n=this.fixedType,i=o.$refs,a=i.tableBody,s=i.leftContainer,d=i.rightContainer,c=i.resizeBar,i=e.target,u=e.clientX,f=i.parentNode,p=0,h=a.$el,a=_tools.DomTools.getOffsetPos(i,r),r=i.clientWidth,i=Math.floor(r/2),m=_tools.UtilTools.getColMinWidth(o,l)-i,y=a.left-f.clientWidth+r+m,x=a.left+i,g=document.onmousemove,b=document.onmouseup,C="left"===n,_="right"===n,v=0;if(C||_){for(var w=C?"nextElementSibling":"previousElementSibling",T=f[w];T&&!_tools.DomTools.hasClass(T,"fixed--hidden");)_tools.DomTools.hasClass(T,"col--group")||(v+=T.offsetWidth),T=T[w];_&&d&&(x=d.offsetLeft+v)}i=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-u,e=x+t,t=n?0:h.scrollLeft;C?e=Math.min(e,(d?d.offsetLeft:h.clientWidth)-v-m):_?(y=(s?s.clientWidth:0)+v+m,e=Math.min(e,x+f.clientWidth-m)):y=Math.max(h.scrollLeft,y),p=Math.max(e,y),c.style.left="".concat(p-t,"px")};o._isResize=!0,_tools.DomTools.addClass(o.$el,"drag--resize"),c.style.display="block",document.onmousemove=i,document.onmouseup=function(){document.onmousemove=g,document.onmouseup=b,l.resizeWidth=l.renderWidth+(_?x-p:p-x),c.style.display="none",o._isResize=!1,o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.saveCustomResizable(),o.recalculate(!0).then(function(){o.updateCellAreas()}),_tools.DomTools.removeClass(o.$el,"drag--resize"),o.emitEvent("resizable-change",t,e)},i(e),o.closeMenu()}}};exports.default=_default;