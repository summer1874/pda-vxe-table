"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_filter:function(e,t){_tools.UtilTools.warn("vxe.error.delFunc",["filter","setFilter"]);e=this.getColumnByField(e);if(e){var i=e.filters;if(i&&t){t=t(i);return _ctor.default.isArray(t)&&(e.filters=_tools.UtilTools.getFilters(t)),this.$nextTick().then(function(){return i})}}return this.$nextTick()},_setFilter:function(e,t){return e.filters&&t&&(e.filters=_tools.UtilTools.getFilters(t)),this.$nextTick()},checkFilterOptions:function(){var e=this.filterStore;e.isAllSelected=e.options.every(function(e){return e._checked}),e.isIndeterminate=!e.isAllSelected&&e.options.some(function(e){return e._checked})},triggerFilterEvent:function(e,s,t){var n,f,a,c,u=this.$refs,h=this.filterStore;h.column===s&&h.visible?h.visible=!1:(n=u.tableBody.$el,f=e.target,a=e.pageX,c=_tools.DomTools.getDomNode().visibleWidth,Object.assign(h,{args:t,multiple:s.filterMultiple,options:s.filters,column:s,style:null,visible:!0}),h.options.forEach(function(e){e._checked=e.checked}),this.checkFilterOptions(),this.hasFilterPanel=!0,this.$nextTick(function(){var e,t,i,l=u.filterWrapper.$el.offsetWidth,r=l/2,o={top:"".concat(f.offsetTop+f.offsetParent.offsetTop+f.offsetHeight+8,"px")};"left"===s.fixed?e=f.offsetLeft+f.offsetParent.offsetLeft-r:"right"===s.fixed?t=f.offsetParent.offsetWidth-f.offsetLeft+(f.offsetParent.offsetParent.offsetWidth-f.offsetParent.offsetLeft)-s.renderWidth-r:e=f.offsetLeft+f.offsetParent.offsetLeft-r-n.scrollLeft,e?(0<(i=a+l-r+32-c)&&(e-=i),o.left="".concat(Math.max(32,e),"px")):t&&(0<(r=a+l-r+32-c)&&(t+=r),o.right="".concat(t,"px")),h.style=o}))},_getCheckedFilters:function(){var e=this.visibleColumn,o=[];return e.filter(function(e){var t=e.property,i=e.filters,l=[],r=[];i&&i.length&&(i.forEach(function(e){e.checked&&(l.push(e.value),r.push(e.data))}),l.length&&o.push({column:e,property:t,values:l,datas:r}))}),o},confirmFilterEvent:function(e){var t=this,i=this.filterStore,l=this.remoteFilter,r=this.filterOpts,o=this.scrollXLoad,s=this.scrollYLoad,n=i.column,f=n.property,a=[],c=[];n.filters.forEach(function(e){e.checked&&(a.push(e.value),c.push(e.data))}),i.visible=!1,r.remote||l||(this.handleTableData(!0),this.checkSelectionStatus()),this.emitEvent("filter-change",{column:n,property:f,field:f,prop:f,values:a,datas:c,filters:this.getCheckedFilters()},e),this.updateFooter(),(o||s)&&(this.clearScroll(),s&&this.updateScrollYSpace()),this.closeFilter(),this.$nextTick(function(){t.recalculate(),t.updateCellAreas()})},handleClearFilter:function(e){var t,i;e&&(t=e.filters,i=e.filterRender,t&&(t.forEach(function(e){e._checked=!1,e.checked=!1,e.data=_ctor.default.clone(e.resetValue,!0)}),(i=i?_vXETable.default.renderer.get(i.name):null)&&i.filterResetMethod&&i.filterResetMethod({options:t,column:e,$table:this})))},resetFilterEvent:function(e){this.handleClearFilter(this.filterStore.column),this.confirmFilterEvent(e)},_clearFilter:function(e){arguments.length&&_ctor.default.isString(e)&&(e=this.getColumnByField(e));var t=this.filterStore;return e?this.handleClearFilter(e):this.visibleColumn.forEach(this.handleClearFilter),e&&e===t.column||Object.assign(t,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()}}};exports.default=_default;