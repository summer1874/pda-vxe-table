"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.DomTools=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_utils=_interopRequireDefault(require("./utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var browse=_ctor.default.browse(),htmlElem=browse.isDoc?document.querySelector("html"):0,bodyElem=browse.isDoc?document.body:0,reClsMap={};function getClsRE(e){return reClsMap[e]||(reClsMap[e]=new RegExp("(?:^|\\s)".concat(e,"(?!\\S)"),"g")),reClsMap[e]}function getNodeOffset(e,t,o){if(e){var r=e.parentNode;if(o.top+=e.offsetTop,o.left+=e.offsetLeft,r&&r!==htmlElem&&r!==bodyElem&&(o.top-=r.scrollTop,o.left-=r.scrollLeft),(!t||e!==t&&e.offsetParent!==t)&&e.offsetParent)return getNodeOffset(e.offsetParent,t,o)}return o}var DomTools={browse:browse,isPx:function(e){return e&&/^\d+(px)?$/.test(e)},isScale:function(e){return e&&/^\d+%$/.test(e)},hasClass:function(e,t){return e&&e.className&&e.className.match&&e.className.match(getClsRE(t))},removeClass:function(e,t){e&&DomTools.hasClass(e,t)&&(e.className=e.className.replace(getClsRE(t),""))},addClass:function(e,t){e&&!DomTools.hasClass(e,t)&&(DomTools.removeClass(e,t),e.className="".concat(e.className," ").concat(t))},updateCellTitle:function(e,t){t="html"===t.type?e.innerText:e.textContent;e.getAttribute("title")!==t&&e.setAttribute("title",t)},rowToVisible:function(e,t){var o=e.$refs.tableBody.$el,r=o.querySelector('[data-rowid="'.concat(_utils.default.getRowid(e,t),'"]'));if(r){var l=o.clientHeight,n=o.scrollTop,o=r.offsetTop+(r.offsetParent?r.offsetParent.offsetTop:0),r=r.clientHeight;if(o<n||n+l<o)return e.scrollTo(null,o);if(l+n<=o+r)return e.scrollTo(null,n+r)}else if(e.scrollYLoad)return e.scrollTo(null,(e.afterFullData.indexOf(t)-1)*e.scrollYStore.rowHeight);return Promise.resolve()},colToVisible:function(e,t){var o=e.$refs.tableBody.$el,r=o.querySelector(".".concat(t.id));if(r){var l=o.clientWidth,n=o.scrollLeft,o=r.offsetLeft+(r.offsetParent?r.offsetParent.offsetLeft:0),r=r.clientWidth;if(o<n||n+l<o)return e.scrollTo(o);if(l+n<=o+r)return e.scrollTo(n+r)}else if(e.scrollXLoad){for(var s=e.visibleColumn,i=0,a=0;a<s.length&&s[a]!==t;a++)i+=s[a].renderWidth;return e.scrollTo(i)}return Promise.resolve()},getDomNode:function(){var e=document.documentElement,t=document.body;return{scrollTop:e.scrollTop||t.scrollTop,scrollLeft:e.scrollLeft||t.scrollLeft,visibleHeight:e.clientHeight||t.clientHeight,visibleWidth:e.clientWidth||t.clientWidth}},getEventTargetNode:function(e,t,o,r){for(var l,n=e.target;n&&n.nodeType&&n!==document;){if(o&&DomTools.hasClass(n,o)&&(!r||r(n)))l=n;else if(n===t)return{flag:!o||!!l,container:t,targetElem:l};n=n.parentNode}return{flag:!1}},getOffsetPos:function(e,t){return getNodeOffset(e,t,{left:0,top:0})},getAbsolutePos:function(e){var t=e.getBoundingClientRect(),o=t.top,e=t.left,t=DomTools.getDomNode();return{boundingTop:o,top:t.scrollTop+o,boundingLeft:e,left:t.scrollLeft+e,visibleHeight:t.visibleHeight,visibleWidth:t.visibleWidth}},getCellNodeIndex:function(e){var t=e.parentNode;return{columnIndex:_ctor.default.arrayIndexOf(t.children,e),rowIndex:_ctor.default.arrayIndexOf(t.parentNode.children,t)}},getRowNodes:function(e,t,o){for(var r=t.columnIndex,t=t.rowIndex,l=o.columnIndex,o=o.rowIndex,n=[],s=Math.min(t,o),i=Math.max(t,o);s<=i;s++){for(var a=[],c=e[s],f=Math.min(r,l),u=Math.max(r,l);f<=u;f++){var d=c.children[f];a.push(d)}n.push(a)}return n},getCellIndexs:function(e){var t=e.parentNode,o=t.getAttribute("data-rowid"),e=[].indexOf.call(t.children,e);return{rowid:o,rowIndex:[].indexOf.call(t.parentNode.children,t),columnIndex:e}},toView:function(e){var t="scrollIntoViewIfNeeded",o="scrollIntoView";e&&(e[t]?e[t]():e[o]&&e[o]())},triggerEvent:function(e,t){var o;"function"==typeof Event?o=new Event(t):(o=document.createEvent("Event")).initEvent(t,!0,!0),e.dispatchEvent(o)},calcHeight:function(e,t){var o=e[t],t=0;return o&&("auto"===o?t=e.parentHeight:(t=DomTools.isScale(o)?Math.floor(parseInt(o)/100*e.parentHeight):_ctor.default.toNumber(o),t-=e.getExcludeHeight())),t}},_default=exports.DomTools=DomTools;exports.default=DomTools;