"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var getRowid=_tools.UtilTools.getRowid,getRowkey=_tools.UtilTools.getRowkey,setCellValue=_tools.UtilTools.setCellValue,getCellLabel=_tools.UtilTools.getCellLabel,hasChildrenList=_tools.UtilTools.hasChildrenList,browse=_tools.DomTools.browse,calcHeight=_tools.DomTools.calcHeight,hasClass=_tools.DomTools.hasClass,addClass=_tools.DomTools.addClass,removeClass=_tools.DomTools.removeClass,getEventTargetNode=_tools.DomTools.getEventTargetNode,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _ctor.default.uniqueId("row_")}function eqCellNull(e){return""===e||_ctor.default.eqNull(e)}function eqCellValue(e,t,r){e=_ctor.default.get(e,r),r=_ctor.default.get(t,r);return!(!eqCellNull(e)||!eqCellNull(r))||(_ctor.default.isString(e)||_ctor.default.isNumber(e)?e==r:_ctor.default.isEqual(e,r))}function getNextSortOrder(e,t){e=e.sortOpts.orders,t=t.order||null,t=e.indexOf(t)+1;return e[t<e.length?t:0]}function getCustomStorageMap(e){var t=_conf.default.version,e=_ctor.default.toStringJSON(localStorage.getItem(e));return e&&e._v===t?e:{_v:t}}function getRecoverRow(e,t){var r=e.fullAllDataRowMap;return t.filter(function(e){return r.has(e)})}function handleReserveRow(e,t){var r=e.fullDataRowIdData,o=[];return _ctor.default.each(t,function(e,t){r[t]&&-1===o.indexOf(r[t].row)&&o.push(r[t].row)}),o}function setMerges(e,t,l,s){if(t){var r=e.treeConfig,a=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-footer-items"]));_ctor.default.isArray(t)||(t=[t]),t.forEach(function(e){var t,r=e.row,o=e.col,i=e.rowspan,n=e.colspan;s&&_ctor.default.isNumber(r)&&(r=s[r]),_ctor.default.isNumber(o)&&(o=a[o]),(s?r:_ctor.default.isNumber(r))&&o&&(i||n)&&(i=_ctor.default.toNumber(i)||1,n=_ctor.default.toNumber(n)||1,(1<i||1<n)&&(t=_ctor.default.findIndexOf(l,function(e){return e._row===r&&e._col===o}),(e=l[t])?(e.rowspan=i,e.colspan=n,e._rowspan=i,e._colspan=n):(t=s?s.indexOf(r):r,e=a.indexOf(o),l.push({row:t,col:e,rowspan:i,colspan:n,_row:r,_col:o,_rowspan:i,_colspan:n}))))})}}function removeMerges(e,t,o,i){var n=[];if(t){var r=e.treeConfig,l=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-cells"]));_ctor.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col;i&&_ctor.default.isNumber(t)&&(t=i[t]),_ctor.default.isNumber(r)&&(r=l[r]);e=_ctor.default.findIndexOf(o,function(e){return e._row===t&&e._col===r});-1<e&&(e=o.splice(e,1),n.push(e[0]))})}return n}var Methods={getParentElem:function(){return(this.$xegrid||this).$el.parentNode},getParentHeight:function(){return this.$xegrid?this.$xegrid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$xegrid?this.$xegrid.getExcludeHeight():0},clearAll:function(){return this.inited=!1,this.clearSort(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearRadioRow(),this.clearRadioReserve(),this.clearCheckboxRow(),this.clearCheckboxReserve(),this.clearRowExpand(),this.clearRowExpandReserve(),this.clearTreeExpand(),this.clearTreeExpandReserve(),_vXETable.default._edit&&this.clearActived(),_vXETable.default._filter&&this.clearFilter(),(this.keyboardConfig||this.mouseConfig)&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked(),this.clearSelected(),this.clearCopyed()),this.mouseConfig&&(this.clearCellAreas(),this.clearCopyCellArea()),this.clearScroll()},refreshData:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["refreshData","syncData"]),this.syncData()},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,r=this.scrollYStore,e=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?e.slice(r.startIndex,Math.max(r.startIndex+r.renderSize,1)):e.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,r=this.keepSource,o=this.treeConfig,i=this.editStore,n=this.sYOpts,l=this.scrollYStore,s=e?e.slice(0):[],n=!o&&-1<n.gt&&n.gt<s.length;return l.startIndex=0,l.visibleIndex=0,l.renderSize=1,i.insertList=[],i.removeList=[],this.tableFullData=s,this.updateCache(!0),this.tableSynchData=e,r&&(this.tableSourceData=_ctor.default.clone(s,!0)),(this.scrollYLoad=n)&&(this.height||this.maxHeight||_tools.UtilTools.error("vxe.error.reqProp",["height | max-height"]),this.showOverflow||_tools.UtilTools.warn("vxe.error.reqProp",["show-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"])),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),this.updateFooter(),this.computeScrollLoad().then(function(){return t.isLoadData=!0,t.computeRowHeight(),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(t.recalculate).then(t.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e).then(this.recalculate)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,r){var o=this.tableSourceData,i=this.tableData;if(!this.keepSource)return _tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick();var n=this.getRowIndex(e),l=o[n];return l&&e&&(r?_ctor.default.set(l,r,_ctor.default.get(t||e,r)):t?(o[n]=t,_ctor.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_ctor.default.destructuring(l,_ctor.default.clone(e,!0))),this.tableData=i.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_ctor.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)}),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(l){function e(e,t,r,o,i){var n=getRowid(s,e);n||(n=getRowUniqueId(),_ctor.default.set(e,g,n)),v&&e[c.hasChild]&&_ctor.default.isUndefined(e[c.children])&&(e[c.children]=null),i={row:e,rowid:n,index:a&&i?-1:t,items:r,parent:i},l&&(d[n]=i,h.set(e,i)),f[n]=i,u.set(e,i)}var s=this,a=this.treeConfig,c=this.treeOpts,t=this.tableFullData,h=this.fullDataRowMap,u=this.fullAllDataRowMap,d=this.fullDataRowIdData,f=this.fullAllDataRowIdData,g=getRowkey(this),v=a&&c.lazy;l&&(d=this.fullDataRowIdData={},h.clear()),f=this.fullAllDataRowIdData={},u.clear(),a?_ctor.default.eachTree(t,e,c):t.forEach(e)},appendTreeCache:function(e,t){var r,l=this,o=this.keepSource,i=this.tableSourceData,n=this.treeOpts,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,h=this.fullAllDataRowIdData,u=n.children,d=n.hasChild,f=getRowkey(this),g=getRowid(this,e);o&&(r=_ctor.default.findTree(i,function(e){return g===getRowid(l,e)},n)),_ctor.default.eachTree(t,function(e,t,r,o,i){var n=getRowid(l,e);n||(n=getRowUniqueId(),_ctor.default.set(e,f,n)),e[d]&&_ctor.default.isUndefined(e[u])&&(e[u]=null);i={row:e,rowid:n,index:-1,items:r,parent:i};s[n]=i,a.set(e,i),h[n]=i,c.set(e,i)},n),r&&(r.item[u]=_ctor.default.clone(t,!0))},cacheColumnMap:function(){function l(e,t,r,o,i){var n=e.id,l=e.property,s=e.fixed,a=e.type,c=e.treeNode,i={column:e,colid:n,index:t,items:r,parent:i};l&&(x[l]&&_tools.UtilTools.error("vxe.error.colRepet",["field",l]),x[l]=i),!g&&s&&(g=s),c?(u&&_tools.UtilTools.warn("vxe.error.colRepet",["tree-node",c]),u=u||e):"expand"===a&&(h&&_tools.UtilTools.warn("vxe.error.colRepet",["type",a]),h=h||e),"checkbox"===a?(d&&_tools.UtilTools.warn("vxe.error.colRepet",["type",a]),d=d||e):"radio"===a&&(f&&_tools.UtilTools.warn("vxe.error.colRepet",["type",a]),f=f||e),p[n]&&_tools.UtilTools.error("vxe.error.colRepet",["colId",n]),p[n]=i,v.set(e,i)}var h,u,d,f,g,e=this.isGroup,t=this.tableFullColumn,r=this.collectColumn,v=this.fullColumnMap,p=this.fullColumnIdData={},x=this.fullColumnFieldData={};v.clear(),e?_ctor.default.eachTree(r,function(e,t,r,o,i,n){e.level=n.length,l(e,t,r,0,i)}):t.forEach(l),h&&g&&_tools.UtilTools.warn("vxe.error.errConflicts",["column.fixed","column.type=expand"]),h&&this.mouseOpts.area&&_tools.UtilTools.error("vxe.error.errConflicts",["mouse-config.area","column.type=expand"]),this.treeNodeColumn=u,this.expandColumn=h},getRowNode:function(e){if(e){e=this.fullAllDataRowIdData[e.getAttribute("data-rowid")];if(e)return{rowid:e.rowid,item:e.row,index:e.index,items:e.items,parent:e.parent}}return null},getColumnNode:function(e){if(e){e=this.fullColumnIdData[e.getAttribute("data-colid")];if(e)return{colid:e.colid,item:e.column,index:e.index,items:e.items,parent:e.parent}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getVTRowIndex:function(e){return this.afterFullData.indexOf(e)},_getRowIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["_getRowIndex","getVTRowIndex"]),this.getVTRowIndex(e)},getVMRowIndex:function(e){return this.tableData.indexOf(e)},$getRowIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["$getRowIndex","getVMRowIndex"]),this.getVMRowIndex(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getVTColumnIndex:function(e){return this.visibleColumn.indexOf(e)},_getColumnIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["_getColumnIndex","getVTColumnIndex"]),this.getVTColumnIndex(e)},getVMColumnIndex:function(e){return this.tableColumn.indexOf(e)},$getColumnIndex:function(e){return"development"===process.env.VUE_APP_VXE_TABLE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["$getColumnIndex","getVMColumnIndex"]),this.getVMColumnIndex(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},defineField:function(r){var e=this.radioOpts,t=this.checkboxOpts,o=this.treeConfig,i=this.treeOpts,n=this.expandOpts,l=getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,e=e.editRender;t&&!_ctor.default.has(r,t)&&_ctor.default.set(r,t,e&&!_ctor.default.isUndefined(e.defaultValue)?e.defaultValue:null)}),[e.labelField,t.checkField,t.labelField,n.labelField].forEach(function(e){e&&!_ctor.default.get(r,e)&&_ctor.default.set(r,e,null)}),o&&i.lazy&&_ctor.default.isUndefined(r[i.children])&&(r[i.children]=null),_ctor.default.get(r,l)||_ctor.default.set(r,l,getRowUniqueId()),r},createData:function(e){var t=this,r=getRowkey(this),o=e.map(function(e){return t.defineField(Object.assign({},e,_defineProperty({},r,null)))});return this.$nextTick().then(function(){return o})},createRow:function(e){var t=this,r=_ctor.default.isArray(e);return r||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return r?e:e[0]})})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,r){var o=this,i=this.tableSourceData,n=this.treeConfig;return this.keepSource?arguments.length?(e&&!_ctor.default.isArray(e)&&(e=[e]),e.forEach(function(e){if(!o.isInsertByRow(e)){var t=o.getRowIndex(e);if(n&&-1===t)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["revertData"]));t=i[t];t&&e&&(r?_ctor.default.set(e,r,_ctor.default.clone(_ctor.default.get(t,r),!0)):_ctor.default.destructuring(e,_ctor.default.clone(t,!0)))}}),this.$nextTick()):this.reloadData(i):(_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var r=this.tableFullData,o=this.visibleColumn;return arguments.length?e&&!_ctor.default.isArray(e)&&(e=[e]):e=r,t?e.forEach(function(e){return _ctor.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var r=this,o=this.visibleColumn,i=this.keepSource,n=this.treeConfig,l=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(i){var c,h,u=getRowid(this,e);if(!a[u])return!1;if(n?(n=l.children,l=_ctor.default.findTree(s,function(e){return u===getRowid(r,e)},l),e=Object.assign({},e,_defineProperty({},n,null)),l&&(h=Object.assign({},l.item,_defineProperty({},n,null)))):h=s[a[u].index],h){if(1<arguments.length)return!eqCellValue(h,e,t);for(var d=0,f=o.length;d<f;d++)if((c=o[d].property)&&!eqCellValue(h,e,c))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getSelectRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getSelectRecords","getCheckboxRecords"]),this.getCheckboxRecords()},getCheckboxRecords:function(){var t,e=this.tableFullData,r=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts.checkField;return i?r?_ctor.default.filterTree(e,function(e){return _ctor.default.get(e,i)},o):e.filter(function(e){return _ctor.default.get(e,i)}):(t=this.selection,r?_ctor.default.filterTree(e,function(e){return-1<t.indexOf(e)},o):e.filter(function(e){return-1<t.indexOf(e)}))},updateAfterFullData:function(){var t,e=this.visibleColumn,r=this.tableFullData,o=this.remoteSort,a=this.remoteFilter,c=this.filterOpts,i=this.sortOpts,r=r.slice(0),n=_ctor.default.find(e,function(e){return e.order}),l=[],s=[];return e.forEach(function(e){var t,r;e.filters&&e.filters.length&&(t=[],r=[],e.filters.forEach(function(e){e.checked&&(r.push(e),t.push(e.value))}),l.push({column:e,valueList:t,itemList:r})),e.sortable&&e.order&&s.push({column:e,sortBy:e.sortBy,property:e.property,order:e.order})}),l.length&&(r=r.filter(function(s){return l.every(function(e){var t=e.column,r=e.valueList,o=e.itemList;if(!r.length||c.remote||a)return!0;var i=t.filterRender,n=t.property,l=t.filterMethod,e=c.filterMethod,i=i?_vXETable.default.renderer.get(i.name):null;return!l&&i&&i.renderFilter&&(l=i.filterMethod),e&&!l?e({options:o,values:r,row:s,column:t}):l?o.some(function(e){return l({value:e.value,option:e,row:s,column:t})}):-1<r.indexOf(_ctor.default.get(s,n))})})),n&&n.order&&(e=i.sortMethod||this.sortMethod,(_ctor.default.isBoolean(n.remoteSort)?n.remoteSort:i.remote||o)||(r=e?e({data:r,column:n,property:n.property,order:n.order,sortList:s,$table:this})||r:(t={$table:this},e=n.sortMethod?r.sort(n.sortMethod):_ctor.default.sortBy(r,n.sortBy||(n.formatter?function(e){return getCellLabel(e,n,t)}:n.property)),"desc"===n.order?e.reverse():e))),this.afterFullData=r},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,r=this.tableData,o=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:r.slice(0),footerData:o.slice(0)}},handleDefaults:function(){var e=this;(this.checkboxConfig||this.selectConfig)&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.mergeCells&&this.handleDefaultMergeCells(),this.mergeFooterItems&&this.handleDefaultMergeFooterItems(),this.$nextTick(function(){return setTimeout(e.recalculate)})},mergeCustomColumn:function(r){var e=this.tableFullColumn;this.isUpdateCustoms=!0,r.length&&e.forEach(function(t){var e=_ctor.default.find(r,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_ctor.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_ctor.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.emitEvent("update:customs",e)},resetAll:function(){_tools.UtilTools.warn("vxe.error.delFunc",["resetAll","resetColumn"]),this.resetColumn(!0)},hideColumn:function(e){return e.visible=!1,this.handleCustom()},showColumn:function(e){return e.visible=!0,this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,r=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){r.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),r.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},resetResizable:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["resetResizable","resetColumn"]),this.resetColumn()},reloadCustoms:function(e){var t=this;return _tools.UtilTools.warn("vxe.error.delFunc",["reloadCustoms","column.visible & refreshColumn"]),this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},restoreCustomStorage:function(){var r,o,e=this.$toolbar,t=this.collectColumn,i=this.customConfig,n=this.customOpts,l=n.storage,s=!0===n.storage,n=s||l&&l.resizable||e&&e.resizableOpts.storage,l=s||l&&l.visible||e&&e.customOpts.storage;(i||e)&&(n||l)&&(e=i?this.id:e?e.id:null,r={},e?(!n||(n=getCustomStorageMap(resizableStorageKey)[e])&&_ctor.default.each(n,function(e,t){r[t]={field:t,resizeWidth:e}}),!l||(l=getCustomStorageMap(visibleStorageKey)[e])&&(l=(e=l.split("|"))[0]?e[0].split(","):[],e=e[1]?e[1].split(","):[],l.forEach(function(e){r[e]?r[e].visible=!1:r[e]={field:e,visible:!1}}),e.forEach(function(e){r[e]?r[e].visible=!0:r[e]={field:e,visible:!0}})),o={},_ctor.default.eachTree(t,function(e){var t=e.getKey();t&&(o[t]=e)}),_ctor.default.each(r,function(e,t){var r=e.visible,e=e.resizeWidth,t=o[t];t&&(_ctor.default.isNumber(e)&&(t.resizeWidth=e),_ctor.default.isBoolean(r)&&(t.visible=r))})):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},saveCustomVisible:function(){var r,o,e=this.$toolbar,t=this.collectColumn,i=this.customConfig,n=this.customOpts,l=n.checkMethod,s=n.storage,s=!0===n.storage||s&&s.visible||e&&e.customOpts.storage;(i||e)&&s&&(i=i?this.id:e?e.id:null,e=getCustomStorageMap(visibleStorageKey),r=[],o=[],i?(_ctor.default.eachTree(t,function(e){var t;l&&!l({column:e})||(!e.visible&&e.defaultVisible?(t=e.getKey())&&r.push(t):!e.visible||e.defaultVisible||(e=e.getKey())&&o.push(e))}),e[i]=[r.join(",")].concat(o.length?[o.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_ctor.default.toJSONString(e))):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},saveCustomResizable:function(e){var r,t=this.$toolbar,o=this.collectColumn,i=this.customConfig,n=this.customOpts,l=n.storage,l=!0===n.storage||l&&l.resizable||t&&t.resizableOpts.storage;(i||t)&&l&&(i=i?this.id:t?t.id:null,t=getCustomStorageMap(resizableStorageKey),i?(e||(r=_ctor.default.isPlainObject(t[i])?t[i]:{},_ctor.default.eachTree(o,function(e){var t;!e.resizeWidth||(t=e.getKey())&&(r[t]=e.renderWidth)})),t[i]=_ctor.default.isEmpty(r)?void 0:r,localStorage.setItem(resizableStorageKey,_ctor.default.toJSONString(t))):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},refreshColumn:function(){var t,r,o,e=this,l=[],s=[],a=[],i=this.collectColumn,n=this.tableFullColumn,c=this.isGroup,h=this.columnStore,u=this.sXOpts,d=this.scrollXStore;c?(t=[],r=[],o=[],_ctor.default.eachTree(i,function(e,t,r,o,i){var n=hasChildrenList(e);i&&i.fixed&&(e.fixed=i.fixed),i&&e.fixed!==i.fixed&&_tools.UtilTools.error("vxe.error.groupFixed"),n?e.visible=!!_ctor.default.findTree(e.children,function(e){return hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?l:"right"===e.fixed?a:s).push(e)}),i.forEach(function(e){e.visible&&("left"===e.fixed?t:"right"===e.fixed?o:r).push(e)}),this.tableGroupColumn=t.concat(r).concat(o)):n.forEach(function(e){e.visible&&("left"===e.fixed?l:"right"===e.fixed?a:s).push(e)});var f=l.concat(s).concat(a),i=f,n=-1<u.gt&&u.gt<n.length;return Object.assign(h,{leftList:l,centerList:s,rightList:a}),n&&c&&(n=!1,_tools.UtilTools.warn("vxe.error.scrollXNotGroup")),n&&(this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["footer-span-method"]),Object.assign(d,{startIndex:0,visibleIndex:0}),i=f.slice(d.startIndex,d.startIndex+d.renderSize)),f.length===this.visibleColumn.length&&this.visibleColumn.every(function(e,t){return e===f[t]})||(this.clearMergeCells(),this.clearMergeFooterItems()),this.scrollXLoad=n,this.tableColumn=i,this.visibleColumn=f,this.$nextTick().then(function(){return e.updateFooter(),e.recalculate(!0)}).then(function(){return e.updateCellAreas(),e.$nextTick().then(function(){return e.recalculate()})})},analyColumnWidth:function(){var e=this.columnWidth,t=this.columnMinWidth,r=this.columnOpts,o=r.width||e,i=r.minWidth||t,n=[],l=[],s=[],a=[],c=[],h=[];this.tableFullColumn.forEach(function(e){o&&!e.width&&(e.width=o),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?n:_tools.DomTools.isPx(e.width)?l:_tools.DomTools.isScale(e.width)?a:_tools.DomTools.isPx(e.minWidth)?s:_tools.DomTools.isScale(e.minWidth)?c:h).push(e)}),Object.assign(this.columnStore,{resizeList:n,pxList:l,pxMinList:s,scaleList:a,scaleMinList:c,autoList:h})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,r=this.lastScrollTop;return this.clearScroll().then(function(){if(t||r)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,r)})},recalculate:function(e){var t=this,r=this.$refs,o=r.tableBody,i=r.tableHeader,r=r.tableFooter,n=o?o.$el:null,l=i?i.$el:null,s=r?r.$el:null;return n&&(this.autoCellWidth(l,n,s),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(l,n,s),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,r){var o=0,i=t.clientWidth,n=i,l=n/100,s=this.fit,a=this.columnStore,c=a.resizeList,h=a.pxMinList,u=a.pxList,d=a.scaleList,f=a.scaleMinList,a=a.autoList;if(h.forEach(function(e){var t=parseInt(e.minWidth);o+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);o+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);o+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.width);o+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);o+=t,e.renderWidth=t}),l=0<(n-=o)?Math.floor(n/(f.length+h.length+a.length)):0,s?0<n&&f.concat(h).forEach(function(e){o+=l,e.renderWidth+=l}):l=40,a.forEach(function(e){var t=Math.max(l,40);e.renderWidth=t,o+=t}),s){var g=d.concat(f).concat(h).concat(a),v=g.length-1;if(0<v){var p=i-o;if(0<p){for(;0<p&&0<=v;)p--,g[v--].renderWidth++;o=i}}}h=t.offsetHeight,a=t.scrollHeight>t.clientHeight;this.scrollbarWidth=a?t.offsetWidth-i:0,this.overflowY=a,this.tableWidth=o,this.tableHeight=h,e?(this.headerHeight=e.clientHeight,e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)):this.headerHeight=0,r?(e=r.offsetHeight,this.scrollbarHeight=Math.max(e-r.clientHeight,0),this.overflowX=o>r.clientWidth,this.footerHeight=e):(this.footerHeight=0,this.scrollbarHeight=Math.max(h-t.clientHeight,0),this.overflowX=i<o),this.customHeight=calcHeight(this,"height"),this.customMaxHeight=calcHeight(this,"maxHeight"),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateStyle:function(){var u=this,t=this.$refs,d=this.isGroup,f=this.fullColumnIdData,g=this.tableColumn,v=this.customHeight,p=this.customMaxHeight,x=this.border,w=this.headerHeight,m=this.showFooter,C=this.showOverflow,R=this.showHeaderOverflow,b=this.showFooterOverflow,T=this.footerHeight,E=this.tableHeight,_=this.tableWidth,y=this.scrollbarHeight,S=this.scrollbarWidth,k=this.scrollXLoad,D=this.scrollYLoad,O=this.cellOffsetWidth,M=this.columnStore,$=this.elemStore,e=this.editStore,r=this.currentRow,o=this.mouseConfig,i=t.emptyPlaceholder,n=$["main-body-wrapper"];return i&&(i.style.top="".concat(w,"px"),i.style.height=n?"".concat(n.offsetHeight-y,"px"):""),0<v&&m&&(v+=y),["main","left","right"].forEach(function(a,e){var s=0<e?a:"",c=M["".concat(s,"List")],h=t["".concat(s,"Container")];["header","body","footer"].forEach(function(i){var e,t,r,o=$["".concat(a,"-").concat(i,"-wrapper")],n=$["".concat(a,"-").concat(i,"-table")];"header"===i?(t=_,k&&(s&&(g=c),t=g.reduce(function(e,t){return e+t.renderWidth},0)),n&&(n.style.width=t?"".concat(t+S,"px"):"",browse.msie&&_ctor.default.arrayEach(n.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")})),(e=$["".concat(a,"-").concat(i,"-repair")])&&(e.style.width="".concat(_,"px")),t=$["".concat(a,"-").concat(i,"-list")],d&&t&&_ctor.default.arrayEach(t.querySelectorAll(".col--group"),function(e){var t,r,o,i=u.getColumnNode(e);i&&(i=(t=i.item).showHeaderOverflow,i=_ctor.default.isBoolean(i)?i:R,o=r=0,(i="title"===i||(!0===i||"tooltip"===i)||"ellipsis"===i)&&_ctor.default.eachTree(t.children,function(e){e.children&&t.children.length||o++,r+=e.renderWidth}),e.style.width=i?"".concat(r-o-(x?2:0),"px"):"")})):"body"===i?(e=$["".concat(a,"-").concat(i,"-emptyBlock")],o&&(0<p?o.style.maxHeight="".concat(s?p-w-(m?0:y):p-w,"px"):o.style.height=0<v?"".concat(s?(0<v?v-w-T:E)-(m?0:y):v-w-T,"px"):""),h&&(r="right"===s,t=M["".concat(s,"List")],o&&(o.style.top="".concat(w,"px")),h.style.height="".concat((0<v?v-w-T:E)+w+T-y*(m?2:1),"px"),h.style.width="".concat(t.reduce(function(e,t){return e+t.renderWidth},r?S:0),"px")),r=_,s&&C?r=(g=c).reduce(function(e,t){return e+t.renderWidth},0):k&&(s&&(g=c),r=g.reduce(function(e,t){return e+t.renderWidth},0)),n&&(n.style.width=r?"".concat(r,"px"):"",n.style.paddingRight=S&&s&&(browse["-moz"]||browse.safari)?"".concat(S,"px"):""),e&&(e.style.width=r?"".concat(r,"px"):"")):"footer"===i&&(l=_,s&&C?l=(g=c).reduce(function(e,t){return e+t.renderWidth},0):k&&(s&&(g=c),l=g.reduce(function(e,t){return e+t.renderWidth},0)),o&&(h&&(o.style.top="".concat(0<v?v-T:E+w,"px")),o.style.marginTop="".concat(-y,"px")),n&&(n.style.width=l?"".concat(l+S,"px"):""));var l=$["".concat(a,"-").concat(i,"-colgroup")];l&&_ctor.default.arrayEach(l.children,function(e){var l,t,r,s,o=e.getAttribute("name");"col_gutter"===o&&(e.style.width="".concat(S,"px")),f[o]&&(t=(l=f[o].column).showHeaderOverflow,r=l.showFooterOverflow,o=l.showOverflow,e.style.width="".concat(l.renderWidth,"px"),s="title"===(o="header"===i?_ctor.default.isUndefined(t)||_ctor.default.isNull(t)?R:t:"footer"===i?_ctor.default.isUndefined(r)||_ctor.default.isNull(r)?b:r:_ctor.default.isUndefined(o)||_ctor.default.isNull(o)?C:o)||(!0===o||"tooltip"===o)||"ellipsis"===o,o=$["".concat(a,"-").concat(i,"-list")],"header"===i||"footer"===i?k&&!s&&(s=!0):!k&&!D||s||(s=!0),o&&_ctor.default.arrayEach(o.querySelectorAll(".".concat(l.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),e=e.querySelector(".vxe-cell"),r=l.renderWidth;if(e){if(1<t)for(var o=u.getColumnIndex(l),i=1;i<t;i++){var n=u.getColumns(o+i);n&&(r+=n.renderWidth)}e.style.width=s?"".concat(r-O*t,"px"):""}}))})})}),r&&this.setCurrentRow(r),o&&o.selected&&e.selected.row&&e.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,r=e.leftContainer,e=e.rightContainer,t=t?t.$el:null;t&&(r&&_tools.DomTools[0<t.scrollLeft?"addClass":"removeClass"](r,"scrolling--middle"),e&&_tools.DomTools[t.clientWidth<t.scrollWidth-Math.ceil(t.scrollLeft)?"addClass":"removeClass"](e,"scrolling--middle"))},preventEvent:function(t,e,r,o,i){var n,l=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:l.$xegrid,$table:l,$event:t},r),t,l)})||o&&(n=o()),i&&i(),n},handleGlobalMousedownEvent:function(r){var o=this,i=this.$el,e=this.$refs,t=this.mouseConfig,n=this.mouseOpts,l=this.editStore,s=this.ctxMenuStore,a=this.editOpts,c=this.filterStore,h=this.getRowNode,u=l.actived,d=e.filterWrapper,l=e.validTip,n=t&&n.checked;d&&(getEventTargetNode(r,i,"vxe-cell--filter").flag||getEventTargetNode(r,d.$el).flag||getEventTargetNode(r,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(r,"event.clearFilter",c.args,this.closeFilter)),u.row?!1!==a.autoClear&&(l&&getEventTargetNode(r,l.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(getEventTargetNode(r,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(r,"event.clearActived",u.args,function(){var e,t;(e=(e=(e="row"===a.mode?!!(t=getEventTargetNode(r,i,"vxe-body--row")).flag&&h(t.targetElem).item!==u.args.row:!getEventTargetNode(r,i,"col--edit").flag)||getEventTargetNode(r,i,"vxe-header--row").flag)||getEventTargetNode(r,i,"vxe-footer--row").flag)||!o.height||o.overflowY||(t=r.target,hasClass(t,"vxe-table--body-wrapper")&&(e=r.offsetY<t.clientHeight)),!e&&getEventTargetNode(r,i).flag||setTimeout(function(){return o.clearActived(r)})}))):t&&(getEventTargetNode(r,i).flag||getEventTargetNode(r,e.tableWrapper).flag||(n&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked()),this.clearSelected(),getEventTargetNode(r,document.body,"vxe-table--ignore-areas-clear").flag||this.preventEvent(r,"event.clearAreas",{},function(){o.clearCellAreas(),o.clearCopyCellArea()}))),s.visible&&this.$refs.ctxWrapper&&!getEventTargetNode(r,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=getEventTargetNode(r,(this.$xegrid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(A){var I=this;this.isActivated&&this.preventEvent(A,"event.keydown",null,function(){var e,t,r,o=I.isCtxMenu,i=I.ctxMenuStore,n=I.editStore,l=I.editOpts,s=I.editConfig,a=I.mouseConfig,c=void 0===a?{}:a,h=I.keyboardConfig,u=void 0===h?{}:h,d=I.treeConfig,f=I.treeOpts,g=I.highlightCurrentRow,v=I.currentRow,p=I.bodyCtxMenu,x=n.selected,w=n.actived,m=A.keyCode,C=8===m,R=9===m,b=13===m,T=27===m,E=32===m,_=37===m,y=38===m,S=39===m,k=40===m,D=46===m,O=65===m,M=113===m,$=93===m,a=A.ctrlKey,h=A.shiftKey,n=_||y||S||k,o=o&&i.visible&&(b||E||n),s=s&&w.column&&w.row;o?(A.preventDefault(),i.showChild&&hasChildrenList(i.selected)?I.moveCtxMenu(A,m,i,"selectChild",37,!1,i.selected.children):I.moveCtxMenu(A,m,i,"selected",39,!0,I.ctxMenuList)):u&&I.mouseConfig&&I.mouseOpts.area&&I.handleKeyboardEvent?I.handleKeyboardEvent(A):E&&(u.isArrow||u.isTab)&&x.row&&x.column&&("checkbox"===x.column.type||"selection"===x.column.type||"radio"===x.column.type)?(A.preventDefault(),"checkbox"===x.column.type||"selection"===x.column.type?I.handleToggleCheckRowEvent(A,x.args):I.triggerRadioRowEvent(A,x.args)):T?(I.closeMenu(),I.closeFilter(),w.row&&(t=w.args,I.clearActived(A),c.selected&&I.$nextTick(function(){return I.handleSelected(t,A)}))):M?s||x.row&&x.column&&(A.preventDefault(),I.handleActived(x.args,A)):$?(I._keyCtx=x.row&&x.column&&p.length,clearTimeout(I.keyCtxTimeout),I.keyCtxTimeout=setTimeout(function(){I._keyCtx=!1},1e3)):b&&u.isEnter&&(x.row||w.row||d&&g&&v)?a?w.row&&(t=w.args,I.clearActived(A),c.selected&&I.$nextTick(function(){return I.handleSelected(t,A)})):x.row||w.row?h?u.enterToTab?I.moveTabSelected(x.args,h,A):I.moveSelected((x.row?x:w).args,_,!0,S,!1,A):u.enterToTab?I.moveTabSelected(x.args,h,A):I.moveSelected((x.row?x:w).args,_,!1,S,!0,A):d&&g&&v&&((c=v[f.children])&&c.length&&(A.preventDefault(),e=c[0],t={$table:I,row:e},I.setTreeExpand(v,!0).then(function(){return I.scrollToRow(e)}).then(function(){return I.triggerCurrentRowEvent(A,t)}))):n&&u.isArrow?s||(x.row&&x.column?I.moveSelected(x.args,_,y,S,k,A):(y||k)&&g&&I.moveCurrentRow(y,k,A)):R&&u.isTab?x.row||x.column?I.moveTabSelected(x.args,h,A):(w.row||w.column)&&I.moveTabSelected(w.args,h,A):D||(d&&g&&v?C&&u.isArrow:C)?s||(u.isDel&&(x.row||x.column)?(setCellValue(x.row,x.column,null),C&&I.handleActived(x.args,A)):C&&u.isArrow&&d&&g&&v&&((r=_ctor.default.findTree(I.afterFullData,function(e){return e===v},f).parent)&&(A.preventDefault(),t={$table:I,row:r},I.setTreeExpand(r,!1).then(function(){return I.scrollToRow(r)}).then(function(){return I.triggerCurrentRowEvent(A,t)})))):u&&a&&O?s||u.isCut&&I.mouseConfig&&I.mouseOpts.checked&&I.handleAllChecked(A):u.isEdit&&!a&&(E||48<=m&&m<=57||65<=m&&m<=90||96<=m&&m<=111||186<=m&&m<=192||219<=m&&m<=222)&&x.column&&x.row&&x.column.editRender&&(u.editMethod&&!1===u.editMethod(x.args,A)||l.activeMethod&&!l.activeMethod(x.args)||(setCellValue(x.row,x.column,null),I.handleActived(x.args,A))),I.emitEvent("keydown",{},A)})},handleGlobalPasteEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.mouseConfig,i=this.mouseOpts,n=this.editStore.actived;t&&(n.row||n.column||(r&&r.isClip&&o&&i.area&&this.handlePasteCellAreaEvent?this.handlePasteCellAreaEvent(e):r&&r.isCut&&o&&i.checked&&this.handlePaste(e)),this.emitEvent("paste",{},e))},handleGlobalCopyEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.mouseConfig,i=this.mouseOpts,n=this.editStore.actived;t&&(n.row||n.column||(r&&r.isClip&&o&&i.area&&this.handleCopyCellAreaEvent?this.handleCopyCellAreaEvent(e):r&&r.isCut&&o&&i.checked&&this.handleCopyed(!1,e)),this.emitEvent("copy",{},e))},handleGlobalCutEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.mouseConfig,i=this.mouseOpts,n=this.editStore.actived;t&&(n.row||n.column||(r&&r.isClip&&o&&i.area&&this.handleCutCellAreaEvent?this.handleCutCellAreaEvent(e):r&&r.isCut&&o&&i.checked&&this.handleCopyed(!0,e)),this.emitEvent("cut",{},e))},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate(!0)},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderHelpEvent:function(e,t){var r,o=t.column.titleHelp;o.message&&(r=this.$refs,t=this.tooltipStore,r=r.tooltip,o=_tools.UtilTools.getFuncText(o.message),this.handleTargetEnterEvent(),t.visible=!0,r&&r.open(e.currentTarget,o))},triggerHeaderTooltipEvent:function(e,t){var r=this.tooltipStore,o=t.column,i=e.currentTarget;this.handleTargetEnterEvent(),r.column===o&&r.visible||this.handleTooltip(e,i,i,null,t)},triggerBodyTooltipEvent:function(e,t){var r,o,i=this.editConfig,n=this.editOpts,l=this.editStore,s=this.tooltipStore,a=l.actived,c=t.row,h=t.column,l=e.currentTarget;this.handleTargetEnterEvent(),i&&("row"===n.mode&&a.row===c||a.row===c&&a.column===h)||s.column===h&&s.row===c&&s.visible||(h.treeNode?(r=l.querySelector(".vxe-tree-cell"),"html"===h.type&&(o=l.querySelector(".vxe-cell--html"))):o=l.querySelector("html"===h.type?".vxe-cell--html":".vxe-cell--label"),this.handleTooltip(e,l,r||l.children[0],o,t))},triggerFooterTooltipEvent:function(e,t){var r=this.tooltipStore,o=t.column,i=e.currentTarget;this.handleTargetEnterEvent(),r.column===o&&r.visible||this.handleTooltip(e,i,i.querySelector(".vxe-cell--item")||i.children[0],null,t)},handleTooltip:function(e,t,r,o,i){i.cell=t;var n=this.$refs,l=this.tooltipOpts,s=this.tooltipStore,a=i.column,c=i.row,h=l.enabled,t=l.contentMethod,l=n.tooltip,n=t?t(i):null,i=t&&!_ctor.default.eqNull(n),t=i?n:("html"===a.type?r.innerText:r.textContent).trim(),n=r.scrollWidth>r.clientWidth;return t&&(h||i||n)&&(Object.assign(s,{row:c,column:a,visible:!0}),l&&l.open(!n&&o||r,_tools.UtilTools.formatText(t))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isCheckboxIndeterminate:function(){return this.isIndeterminate},getCheckboxIndeterminateRecords:function(){var e=this.treeConfig,t=this.treeIndeterminates;return e?t.slice(0):[]},handleDefaultSelectionChecked:function(){var t,r=this.fullDataRowIdData,e=this.checkboxOpts,o=e.checkAll,e=e.checkRowKeys;o?this.setAllCheckboxRow(!0):e&&(t=[],e.forEach(function(e){r[e]&&t.push(r[e].row)}),this.setCheckboxRow(t,!0))},setSelection:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setSelection","setCheckboxRow"]),this.setCheckboxRow(e,t)},setCheckboxRow:function(e,t){var r=this;return e&&!_ctor.default.isArray(e)&&(e=[e]),e.forEach(function(e){return r.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["isCheckedByRow","isCheckedByCheckboxRow"]),this.isCheckedByCheckboxRow(e)},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_ctor.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,r){var o=this,i=e.row,n=this.selection,t=this.afterFullData,l=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,h=c.checkField,e=c.checkStrictly,u=c.checkMethod;if(h)if(l&&!e){-1===r?(-1===a.indexOf(i)&&a.push(i),_ctor.default.set(i,h,!1)):_ctor.default.eachTree([i],function(t){i!==t&&u&&!u({row:t})||(_ctor.default.set(t,h,r),_ctor.default.remove(a,function(e){return e===t}),o.handleCheckboxReserveRow(i,r))},s);c=_ctor.default.findTree(t,function(e){return e===i},s);if(c&&c.parent){var d,f=u?c.items.filter(function(e){return u({row:e})}):c.items;return d=_ctor.default.find(c.items,function(e){return-1<a.indexOf(e)})?-1:(d=c.items.filter(function(e){return _ctor.default.get(e,h)})).filter(function(e){return-1<f.indexOf(e)}).length===f.length||!(!d.length&&-1!==r)&&-1,this.handleSelectRow({row:c.parent},d)}}else u&&!u({row:i})||(_ctor.default.set(i,h,r),this.handleCheckboxReserveRow(i,r));else if(l&&!e){-1===r?(-1===a.indexOf(i)&&a.push(i),_ctor.default.remove(n,function(e){return e===i})):_ctor.default.eachTree([i],function(t){i!==t&&u&&!u({row:t})||(r?n.push(t):_ctor.default.remove(n,function(e){return e===t}),_ctor.default.remove(a,function(e){return e===t}),o.handleCheckboxReserveRow(i,r))},s);s=_ctor.default.findTree(t,function(e){return e===i},s);if(s&&s.parent){var g,v=u?s.items.filter(function(e){return u({row:e})}):s.items;return g=_ctor.default.find(s.items,function(e){return-1<a.indexOf(e)})?-1:(g=s.items.filter(function(e){return-1<n.indexOf(e)})).filter(function(e){return-1<v.indexOf(e)}).length===v.length||!(!g.length&&-1!==r)&&-1,this.handleSelectRow({row:s.parent},g)}}else u&&!u({row:i})||(r?-1===n.indexOf(i)&&n.push(i):_ctor.default.remove(n,function(e){return e===i}),this.handleCheckboxReserveRow(i,r));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var r=this.selection,o=this.checkboxOpts.checkField,i=t.row,i=o?!_ctor.default.get(i,o):-1===r.indexOf(i);e?this.triggerCheckRowEvent(e,t,i):this.handleSelectRow(t,i)},triggerCheckRowEvent:function(e,t,r){var o=this.checkboxOpts.checkMethod;o&&!o({row:t.row})||(this.handleSelectRow(t,r),o=this.getCheckboxRecords(),this.$listeners["select-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-change","checkbox-change"]),this.emitEvent("select-change",Object.assign({records:o,selection:o,reserves:this.getCheckboxReserveRecords(),checked:r},t),e)):this.emitEvent("checkbox-change",Object.assign({records:o,selection:o,reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:r},t),e))},toggleRowSelection:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleRowSelection","toggleCheckboxRow"]),this.toggleCheckboxRow(e)},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent(null,{row:e}),this.$nextTick()},setAllSelection:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllSelection","setAllCheckboxRow"]),this.setAllCheckboxRow(e)},setAllCheckboxRow:function(t){var r=this,o=this.afterFullData,e=this.treeConfig,i=this.treeOpts,n=this.selection,l=this.checkboxReserveRowMap,s=this.checkboxOpts,a=s.checkField,c=s.reserve,h=s.checkStrictly,u=s.checkMethod,d=[],s=e?[]:n.filter(function(e){return-1===o.indexOf(e)});h?this.isAllSelected=t:(a?(h=function(e){u&&!u({row:e})||(t&&d.push(e),_ctor.default.set(e,a,t))},e?_ctor.default.eachTree(o,h,i):o.forEach(h)):e?t?_ctor.default.eachTree(o,function(e){u&&!u({row:e})||d.push(e)},i):u&&_ctor.default.eachTree(o,function(e){!u({row:e})&&-1<n.indexOf(e)&&d.push(e)},i):t?d=u?o.filter(function(e){return-1<n.indexOf(e)||u({row:e})}):o.slice(0):u&&(d=o.filter(function(e){return u({row:e})?0:-1<n.indexOf(e)})),c&&(t?d.forEach(function(e){l[getRowid(r,e)]=e}):o.forEach(function(e){return r.handleCheckboxReserveRow(e,!1)})),this.selection=a?[]:s.concat(d)),this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,r=this.treeIndeterminates,o=this.checkboxOpts,i=this.treeConfig,n=o.checkField,l=o.halfField,s=o.checkStrictly,a=o.checkMethod;s||(s=o=!1,s=n?(o=e.length&&e.every(a?function(e){return!a({row:e})||_ctor.default.get(e,n)}:function(e){return _ctor.default.get(e,n)}),i?l?!o&&e.some(function(e){return _ctor.default.get(e,n)||_ctor.default.get(e,l)||-1<r.indexOf(e)}):!o&&e.some(function(e){return _ctor.default.get(e,n)||-1<r.indexOf(e)}):l?!o&&e.some(function(e){return _ctor.default.get(e,n)||_ctor.default.get(e,l)}):!o&&e.some(function(e){return _ctor.default.get(e,n)})):(o=e.length&&e.every(a?function(e){return!a({row:e})||-1<t.indexOf(e)}:function(e){return-1<t.indexOf(e)}),i?!o&&e.some(function(e){return-1<r.indexOf(e)||-1<t.indexOf(e)}):!o&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=o,this.isIndeterminate=s)},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeOpts,r=this.treeConfig,o=this.fullDataRowIdData,i=this.fullAllDataRowMap,n=this.currentRow,l=this.selectRow,s=this.radioReserveRow,a=this.radioOpts,c=this.checkboxOpts,h=this.selection,u=this.rowExpandeds,d=this.treeExpandeds,f=this.expandOpts;l&&!i.has(l)&&(this.selectRow=null),a.reserve&&s&&(o[s=getRowid(this,s)]&&this.setRadioRow(o[s].row)),this.selection=getRecoverRow(this,h),c.reserve&&this.setCheckboxRow(handleReserveRow(this,this.checkboxReserveRowMap),!0),n&&!i.has(n)&&(this.currentRow=null),this.rowExpandeds=e?getRecoverRow(this,u):[],e&&f.reserve&&this.setRowExpand(handleReserveRow(this,this.rowExpandedReserveRowMap),!0),this.treeExpandeds=r?getRecoverRow(this,d):[],r&&t.reserve&&this.setTreeExpand(handleReserveRow(this,this.treeExpandedReserveRowMap),!0)},getRadioReserveRecord:function(){var e=this.fullDataRowIdData,t=this.radioReserveRow;return this.radioOpts.reserve&&t&&!e[getRowid(this,t)]?t:null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getSelectReserveRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getSelectReserveRecords","getCheckboxReserveRecords"]),this.getCheckboxReserveRecords()},getCheckboxReserveRecords:function(){var t=this.fullDataRowIdData,r=this.checkboxReserveRowMap,e=this.checkboxOpts,o=[];return e.reserve&&Object.keys(r).forEach(function(e){t[e]||o.push(r[e])}),o},clearSelectReserve:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["clearSelectReserve","clearCheckboxReserve"]),this.clearCheckboxReserve()},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var r,o=this.checkboxReserveRowMap;this.checkboxOpts.reserve&&(r=getRowid(this,e),t?o[r]=e:o[r]&&delete o[r])},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t);var r=this.getCheckboxRecords();this.$listeners["select-all"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-all","checkbox-all"]),this.emitEvent("select-all",{records:r,selection:r,reserves:this.getCheckboxReserveRecords(),checked:t},e)):this.emitEvent("checkbox-all",{records:r,selection:r,reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllSelection:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleAllSelection","toggleAllCheckboxRow"]),this.toggleAllCheckboxRow()},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["clearSelection","clearCheckboxRow"]),this.clearCheckboxRow()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,r=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts,n=i.checkField,i=i.reserve;return n&&(r?_ctor.default.eachTree(e,function(e){return _ctor.default.set(e,n,!1)},o):e.forEach(function(e){return _ctor.default.set(e,n,!1)})),i&&e.forEach(function(e){return t.handleCheckboxReserveRow(e,!1)}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,r=e.checkRowKey,e=e.reserve;r&&(t[r]&&this.setRadioRow(t[r].row),e&&(e=getRowkey(this),this.radioReserveRow=_defineProperty({},e,r)))},triggerRadioRowEvent:function(e,t){var r=this.selectRow!==t.row;this.setRadioRow(t.row),r&&this.emitEvent("radio-change",t,e)},triggerCurrentRowEvent:function(e,t){var r=this.currentRow!==t.row;this.setCurrentRow(t.row),r&&this.emitEvent("current-change",t,e)},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_ctor.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(getRowid(this,e),'"]')),function(e){return addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_ctor.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getCurrentRow","getCurrentRecord"]),this.getCurrentRecord()},getCurrentRecord:function(){return this.highlightCurrentRow?this.currentRow:null},getRadioRow:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRadioRow","getRadioRecord"]),this.getRadioRecord()},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){t=t.row;this.setHoverRow(t)},setHoverRow:function(e){var t=getRowid(this,e);this.clearHoverRow(),_ctor.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_ctor.default.arrayEach(this.$el.querySelectorAll(".vxe-body--row.row--hover"),function(e){return removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var r=this._lastResizeTime,o=this.sortOpts,i=t.column,n=e.currentTarget,l=r&&r>Date.now()-300,s=getEventTargetNode(e,n,"vxe-cell--sort").flag,r=getEventTargetNode(e,n,"vxe-cell--filter").flag;return"cell"!==o.trigger||l||s||r||this.triggerSortEvent(e,i,getNextSortOrder(this,i)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:l,triggerSort:s,triggerFilter:r,cell:n},t),e),this.highlightCurrentColumn?this.setCurrentColumn(i):this.$nextTick()},triggerHeaderCellDBLClickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e,this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var r=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var r=this.highlightCurrentRow,o=this.editStore,i=this.radioOpts,n=this.expandOpts,l=this.treeOpts,s=this.editConfig,a=this.editOpts,c=this.checkboxOpts,h=this.mouseConfig,u=this.mouseOpts,d=o.actived,f=t.row,g=t.column,v=g.type,p=g.treeNode,x="radio"===v,w="checkbox"===v||"selection"===v,m="expand"===v,C=e.currentTarget,R=x&&getEventTargetNode(e,C,"vxe-cell--radio").flag,b=w&&getEventTargetNode(e,C,"vxe-cell--checkbox").flag,o=p&&getEventTargetNode(e,C,"vxe-tree--btn-wrapper").flag,v=m&&getEventTargetNode(e,C,"vxe-table--expanded").flag;t=Object.assign({cell:C,triggerRadio:R,triggerCheckbox:b,triggerTreeNode:o,triggerExpandNode:v},t);u=h&&u.checked;!v&&("row"===n.trigger||m&&"cell"===n.trigger)&&this.triggerRowExpandEvent(e,t),("row"===l.trigger||p&&"cell"===l.trigger)&&this.triggerTreeExpandEvent(e,t),o||(v||(r&&(b||R||this.triggerCurrentRowEvent(e,t)),!R&&("row"===i.trigger||x&&"cell"===i.trigger)&&this.triggerRadioRowEvent(e,t),!b&&("row"===c.trigger||w&&"cell"===c.trigger)&&this.handleToggleCheckRowEvent(e,t)),u||s&&("manual"===a.trigger?d.args&&d.row===f&&g!==d.column&&this.handleChangeCell(e,t):d.args&&f===d.row&&g===d.column||("click"===a.trigger||"dblclick"===a.trigger&&"row"===a.mode&&d.row===f)&&this.handleChangeCell(e,t))),this.emitEvent("cell-click",t,e)},triggerCellDBLClickEvent:function(e,t){var r=this,o=this.editStore,i=this.editConfig,n=this.editOpts,l=o.actived,o=e.currentTarget;t.cell=o,i&&"dblclick"===n.trigger&&(l.args&&e.currentTarget===l.args.cell||("row"===n.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})}):"cell"===n.mode&&this.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var t,e,r=this.sortOpts.defaultSort;r&&(t=r.field,e=r.order,t&&e&&((r=_ctor.default.find(this.visibleColumn,function(e){return e.property===t}))&&!r.order&&this.sort(t,e)))},triggerSortEvent:function(e,t,r){var o=t.property;(t.sortable||t.remoteSort)&&(r&&t.order!==r?this.sort(o,r):this.clearSort(),t={column:t,property:o,order:t.order,sortBy:t.sortBy,sortList:this.getSortColumns()},this.emitEvent("sort-change",t,e))},sort:function(e,t){var r=this.tableFullColumn,o=this.sortOpts,e=this.getColumnByField(e);if(e){o=_ctor.default.isBoolean(e.remoteSort)?e.remoteSort:o.remote;if(e.sortable||e.remoteSort)return arguments.length<=1&&(t=getNextSortOrder(this,e)),e.order!==t&&(r.forEach(function(e){e.order=null}),e.order=t,o||this.handleTableData(!0)),this.$nextTick().then(this.updateStyle)}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return _ctor.default.find(this.visibleColumn,function(e){return(e.sortable||e.remoteSort)&&e.order})},isSort:function(e){if(e){e=this.getColumnByField(e);return e&&(e.sortable||e.remoteSort)&&e.order}return 0<this.getSortColumns().length},getSortColumns:function(){var r=[];return this.visibleColumn.forEach(function(e){var t=e.order;(e.sortable||e.remoteSort)&&t&&r.push({column:e,sortBy:e.sortBy,property:e.property,order:t})}),r},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){e=this.getColumnByField(e);return e&&e.filters&&e.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},isRowExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,r=this.expandLazyLoadeds,o=this.fullAllDataRowMap,e=e.lazy,o=o.get(t);return e&&o&&(o.expandLoaded=!1,_ctor.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,r=this.expandOpts,o=this.expandLazyLoadeds;return r.lazy&&-1===o.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var r=this.$listeners,o=this.expandOpts,i=this.expandLazyLoadeds,n=this.expandColumn,l=t.row;o.lazy&&-1!==i.indexOf(l)||(t=!this.isExpandByRow(l),o=this.getColumnIndex(n),i=this.getVMColumnIndex(n),this.setRowExpand(l,t),r["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),this.emitEvent("toggle-expand-change",{expanded:t,column:n,columnIndex:o,$columnIndex:i,row:l,rowIndex:this.getRowIndex(l),$rowIndex:this.getVMRowIndex(l)},e)):this.emitEvent("toggle-row-expand",{expanded:t,column:n,columnIndex:o,$columnIndex:i,row:l,rowIndex:this.getRowIndex(l),$rowIndex:this.getVMRowIndex(l)},e))},toggleRowExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleRowExpansion","toggleRowExpand"]),this.toggleRowExpand(e)},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var t,e=this.expandOpts,r=this.fullDataRowIdData,o=e.expandAll,e=e.expandRowKeys;o?this.setAllRowExpand(!0):e&&(t=[],e.forEach(function(e){r[e]&&t.push(r[e].row)}),this.setRowExpand(t,!0))},setAllRowExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllRowExpansion","setAllRowExpand"]),this.setAllRowExpand(e)},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var r=this,o=this.fullAllDataRowMap.get(t);return new Promise(function(e){r.expandLazyLoadeds.push(t),r.expandOpts.loadMethod({$table:r,row:t,rowIndex:r.getRowIndex(t),$rowIndex:r.getVMRowIndex(t)}).catch(function(e){return e}).then(function(){o.expandLoaded=!0,_ctor.default.remove(r.expandLazyLoadeds,function(e){return e===t}),r.rowExpandeds.push(t),e(r.$nextTick().then(r.recalculate))})})},setRowExpansion:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setRowExpansion","setRowExpand"]),this.setRowExpand(e,t)},setRowExpand:function(e,t){var r,o=this,i=this.fullAllDataRowMap,n=this.expandLazyLoadeds,l=this.expandOpts,s=this.expandColumn,a=this.rowExpandeds,c=l.reserve,h=l.lazy,u=l.accordion,d=l.toggleMethod,f=[],g=this.getColumnIndex(s),v=this.getVMColumnIndex(s);return e&&(_ctor.default.isArray(e)||(e=[e]),u&&(a=[],e=e.slice(e.length-1,e.length)),r=d?e.filter(function(e){return d({expanded:t,column:s,columnIndex:g,$columnIndex:v,row:e,rowIndex:o.getRowIndex(e),$rowIndex:o.getVMRowIndex(e)})}):e,t?r.forEach(function(e){var t;-1===a.indexOf(e)&&(t=i.get(e),h&&!t.expandLoaded&&-1===n.indexOf(e)?f.push(o.handleAsyncRowExpand(e)):a.push(e))}):_ctor.default.remove(a,function(e){return-1<r.indexOf(e)}),c&&r.forEach(function(e){return o.handleRowExpandReserve(e,t)})),this.rowExpandeds=a,Promise.all(f).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var t=this,e=this.expandOpts,r=this.rowExpandeds,o=this.tableFullData,e=e.reserve,i=r.length;return this.rowExpandeds=[],e&&o.forEach(function(e){return t.handleRowExpandReserve(e,!1)}),this.$nextTick().then(function(){i&&t.recalculate()})},clearRowExpandReserve:function(){return this.rowExpandedReserveRowMap={},this.$nextTick()},handleRowExpandReserve:function(e,t){var r,o=this.rowExpandedReserveRowMap;this.expandOpts.reserve&&(r=getRowid(this,e),t?o[r]=e:o[r]&&delete o[r])},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,r=this.treeExpandeds,o=this.fullAllDataRowMap,e=e.lazy,o=o.get(t);return e&&o&&(o.treeLoaded=!1,_ctor.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,r=this.treeOpts,o=this.treeLazyLoadeds,i=r.lazy,r=r.hasChild;return i&&e[r]&&-1===o.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var r=this.$listeners,o=this.treeOpts,i=this.treeLazyLoadeds,n=t.row,l=t.column;o.lazy&&-1!==i.indexOf(n)||(t=!this.isTreeExpandByRow(n),o=this.getColumnIndex(l),i=this.getVMColumnIndex(l),this.setTreeExpand(n,t),r["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),this.emitEvent("toggle-tree-change",{expanded:t,column:l,columnIndex:o,$columnIndex:i,row:n},e)):this.emitEvent("toggle-tree-expand",{expanded:t,column:l,columnIndex:o,$columnIndex:i,row:n},e))},toggleTreeExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleTreeExpansion","toggleTreeExpand"]),this.toggleTreeExpand(e)},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e,r,o,t=this.treeConfig,i=this.treeOpts,n=this.tableFullData;t&&(e=i.expandAll,t=i.expandRowKeys,e?this.setAllTreeExpand(!0):t&&(r=[],o=getRowkey(this),t.forEach(function(t){var e=_ctor.default.findTree(n,function(e){return t===_ctor.default.get(e,o)},i);e&&r.push(e.item)}),this.setTreeExpand(r,!0)))},handleAsyncTreeExpandChilds:function(r){var o=this,e=this.fullAllDataRowMap,i=this.treeExpandeds,t=this.treeOpts,n=this.treeLazyLoadeds,l=this.checkboxOpts,s=t.loadMethod,a=t.children,c=l.checkStrictly,h=e.get(r);return new Promise(function(t){n.push(r),s({$table:o,row:r}).catch(function(){return[]}).then(function(e){h.treeLoaded=!0,_ctor.default.remove(n,function(e){return e===r}),_ctor.default.isArray(e)||(e=[]),e&&(r[a]=e,o.appendTreeCache(r,e),e.length&&-1===i.indexOf(r)&&i.push(r),!c&&o.isCheckedByCheckboxRow(r)&&o.setCheckboxRow(e,!0)),t(o.$nextTick().then(o.recalculate))})})},setAllTreeExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllTreeExpansion","setAllTreeExpand"]),this.setAllTreeExpand(e)},setAllTreeExpand:function(e){var t=this.tableFullData,r=this.treeOpts,o=r.lazy,i=r.children,n=[];return _ctor.default.eachTree(t,function(e){var t=e[i];(o||t&&t.length)&&n.push(e)},r),this.setTreeExpand(n,e)},setTreeExpansion:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setTreeExpansion","setTreeExpand"]),this.setTreeExpand(e,t)},setTreeExpand:function(e,t){var r=this,o=this.fullAllDataRowMap,i=this.tableFullData,n=this.treeExpandeds,l=this.treeOpts,s=this.treeLazyLoadeds,a=this.treeNodeColumn,c=l.reserve,h=l.lazy,u=l.hasChild,d=l.children,f=l.accordion,g=l.toggleMethod,v=[],p=this.getColumnIndex(a),x=this.getVMColumnIndex(a);if(e&&(_ctor.default.isArray(e)||(e=[e]),e.length)){var w,m=g?e.filter(function(e){return g({expanded:t,column:a,columnIndex:p,$columnIndex:x,row:e})}):e;return f&&(m=m.length?[m[m.length-1]]:[],(w=_ctor.default.findTree(i,function(e){return e===m[0]},l))&&_ctor.default.remove(n,function(e){return-1<w.items.indexOf(e)})),t?m.forEach(function(e){var t;-1===n.indexOf(e)&&(t=o.get(e),h&&e[u]&&!t.treeLoaded&&-1===s.indexOf(e)?v.push(r.handleAsyncTreeExpandChilds(e)):e[d]&&e[d].length&&n.push(e))}):_ctor.default.remove(n,function(e){return-1<m.indexOf(e)}),c&&m.forEach(function(e){return r.handleTreeExpandReserve(e,t)}),Promise.all(v).then(this.recalculate)}return this.$nextTick()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var t=this,e=this.treeOpts,r=this.treeExpandeds,o=this.tableFullData,i=e.reserve,n=r.length;return this.treeExpandeds=[],i&&_ctor.default.eachTree(o,function(e){return t.handleTreeExpandReserve(e,!1)},e),this.$nextTick().then(function(){n&&t.recalculate()})},clearTreeExpandReserve:function(){return this.treeExpandedReserveRowMap={},this.$nextTick()},handleTreeExpandReserve:function(e,t){var r,o=this.treeExpandedReserveRowMap;this.treeOpts.reserve&&(r=getRowid(this,e),t?o[r]=e:o[r]&&delete o[r])},getVirtualScroller:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getVirtualScroller","getScroll"]),this.getScroll()},getTableScroll:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getTableScroll","getScroll"]),this.getScroll()},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,r=this.scrollYLoad,e=e.tableBody.$el;return{virtualX:t,virtualY:r,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(e){for(var t=this.$refs,r=this.visibleColumn,o=this.scrollXStore,i=o.startIndex,n=o.renderSize,l=o.offsetSize,s=o.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,h=0,t=e||!1,u=r.length,d=0;d<u;d++)if(a<(h+=r[d].renderWidth)){c=d;break}!e&&o.visibleIndex===c||(e=Math.min(Math.floor((n-s)/2),s),o.visibleIndex===c?o.startIndex=c:o.visibleIndex>c?(t=c-l<=i)&&(o.startIndex=Math.max(0,Math.max(0,c-e))):(t=i+n<=c+s+l)&&(o.startIndex=Math.max(0,Math.min(r.length-n,c-e))),t&&this.updateScrollXData(),o.visibleIndex=c),this.clostTooltip()},triggerScrollYEvent:function(e){var t=this.scrollYStore,r=t.adaptive,o=t.offsetSize,t=t.visibleSize;isWebkit&&r&&2*o+t<=40?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_ctor.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.afterFullData,r=this.scrollYStore,o=this.isLoadData,i=r.startIndex,n=r.renderSize,l=r.offsetSize,s=r.visibleSize,a=r.rowHeight,e=e.target.scrollTop,e=Math.ceil(e/a),a=!1;!o&&r.visibleIndex===e||(o=Math.min(Math.floor((n-s)/2),s),r.visibleIndex>e?(a=e-l<=i)&&(r.startIndex=Math.max(0,e-Math.max(o,n-s))):(a=i+n<=e+s+l)&&(r.startIndex=Math.max(0,Math.min(t.length-n,e-o))),a&&this.updateScrollYData(),r.visibleIndex=e,this.isLoadData=!1)},computeRowHeight:function(){var e,t=this.$refs.tableBody,r=t?t.$el:null,t=this.$refs.tableHeader;r&&(!(r=r.querySelector("tbody>tr"))&&t&&(r=t.$el.querySelector("thead>tr")),r&&(e=r.clientHeight)),e=e||this.rowHeightMaps[this.vSize||"default"],this.rowHeight=e},computeScrollLoad:function(){var x=this;return this.$nextTick().then(function(){var e,t=x.vSize,r=x.scrollXLoad,o=x.scrollYLoad,i=x.sYOpts,n=x.scrollYStore,l=x.sXOpts,s=x.scrollXStore,a=x.visibleColumn,c=x.rowHeightMaps,h=x.$refs.tableBody,u=h?h.$el:null,h=x.$refs.tableHeader;if(u){if(r){var d=u.clientWidth,f=_ctor.default.toNumber(l.vSize);if(!l.vSize)for(var g=f=a.length,v=0,p=0;p<g;p++)if(d<(v+=a[p].renderWidth)){f=p+1;break}s.visibleSize=f,l.oSize||(s.offsetSize=f),l.rSize||(s.renderSize=Math.max(8,f+6)),x.updateScrollXData()}else x.updateScrollXSpace();o?(i.rHeight?e=i.rHeight:(!(o=u.querySelector("tbody>tr"))&&h&&(o=h.$el.querySelector("thead>tr")),o&&(e=o.clientHeight)),e=e||c[t||"default"],u=_ctor.default.toNumber(i.vSize||Math.ceil(u.clientHeight/e)),n.visibleSize=u,n.rowHeight=e,i.oSize||(n.offsetSize=u),i.rSize||(n.renderSize=Math.max(6,browse.edge?10*u:isWebkit?u+2:6*u)),x.updateScrollYData()):x.updateScrollYSpace()}x.$nextTick(x.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,o=this.elemStore,t=this.visibleColumn,r=this.scrollXStore,i=this.scrollXLoad,n=this.tableWidth,l=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,e=e.tableFooter,s=s?s.$el.querySelector(".vxe-table--header"):null,a=a.$el.querySelector(".vxe-table--body"),e=e?e.$el.querySelector(".vxe-table--footer"):null,t=t.slice(0,r.startIndex).reduce(function(e,t){return e+t.renderWidth},0),r="";i&&(r="".concat(t,"px")),s&&(s.style.marginLeft=r),a.style.marginLeft=r,e&&(e.style.marginLeft=r);["main"].forEach(function(r){["header","body","footer"].forEach(function(e){var t=o["".concat(r,"-").concat(e,"-xSpace")];t&&(t.style.width=i?"".concat(n+("header"===e?l:0),"px"):"")})}),this.$nextTick(this.updateStyle)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var r=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,o=this.afterFullData.length*e.rowHeight,e=Math.max(e.startIndex*e.rowHeight,0),i="",n="";t&&(i="".concat(e,"px"),n="".concat(o,"px")),["main","left","right"].forEach(function(t){var e=r["".concat(t,"-body-table")];e&&(e.style.marginTop=i),["header","body","footer"].forEach(function(e){e=r["".concat(t,"-").concat(e,"-ySpace")];e&&(e.style.height=n)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var r=this,o=this.$refs,i=o.tableBody,n=o.rightBody,o=o.tableFooter,i=i?i.$el:null,n=(n?n.$el:null)||i,i=(o?o.$el:null)||i;return _ctor.default.isNumber(e)&&(i.scrollLeft=e),_ctor.default.isNumber(t)&&(n.scrollTop=t),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var r=[];return e&&(this.treeConfig?r.push(this.scrollToTreeRow(e)):r.push(_tools.DomTools.rowToVisible(this,e))),t&&r.push(this.scrollToColumn(t)),Promise.all(r)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var r,o=this,e=this.tableFullData,i=this.treeConfig,n=this.treeOpts;return!i||(n=_ctor.default.findTree(e,function(e){return e===t},n))&&(r=n.nodes).forEach(function(e,t){t<r.length-1&&!o.isTreeExpandByRow(e)&&o.setTreeExpand(e,!0)}),this.$nextTick()},clearScroll:function(){var t=this,e=this.$refs,r=e.tableBody,o=e.rightBody,e=e.tableFooter,r=r?r.$el:null,o=o?o.$el:null,e=e?e.$el:null;return o&&(o.scrollTop=0),e&&(e.scrollLeft=0),r&&(r.scrollTop=0,r.scrollLeft=0),new Promise(function(e){requestAnimationFrame(function(){e(t.$nextTick())})})},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,r=this.footerMethod;return e&&r&&(this.footerData=t.length?r({columns:t,data:this.afterFullData,$table:this,$grid:this.$xegrid}):[]),this.$nextTick()},updateStatus:function(l,s){var a=this,c=!_ctor.default.isUndefined(s);return this.$nextTick().then(function(){var e=a.$refs,t=a.editRules,r=a.validStore;if(l&&e.tableBody&&t){var o=l.row,i=l.column;if(a.hasCellRules("change",o,i)){var n=a.getCell(o,i);if(n)return a.validCellRules("change",o,i,s).then(function(){c&&r.visible&&setCellValue(o,i,s),a.clearValidate()}).catch(function(e){e=e.rule;c&&setCellValue(o,i,s),a.showValidTooltip({rule:e,row:o,column:i,cell:n})})}}})},handleDefaultMergeCells:function(){this.setMergeCells(this.mergeCells)},setMergeCells:function(e){var t=this;return this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]),setMerges(this,e,this.mergeList,this.afterFullData),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeCells:function(e){var t=this;this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]);var r=removeMerges(this,e,this.mergeList,this.afterFullData);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeCells:function(){return this.mergeList.slice(0)},clearMergeCells:function(){return this.mergeList=[],this.$nextTick()},handleDefaultMergeFooterItems:function(){this.setMergeFooterItems(this.mergeFooterItems)},setMergeFooterItems:function(e){var t=this;return this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),setMerges(this,e,this.mergeFooterList,null),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeFooterItems:function(e){var t=this;this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]);var r=removeMerges(this,e,this.mergeFooterList,null);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeFooterItems:function(){return this.mergeFooterList.slice(0)},clearMergeFooterItems:function(){return this.mergeFooterList=[],this.$nextTick()},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex())},updateCellAreas:function(){this.mouseConfig&&this.mouseOpts.area&&this.handleUpdateCellAreas&&this.handleUpdateCellAreas()},emitEvent:function(e,t,r){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:r},t),r)},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},connect:function(e){return e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):_tools.UtilTools.error("vxe.error.barUnableLink"),this.$nextTick()},getEventTargetNode:getEventTargetNode,getCell:function(e,t){var r=this.$refs,e=getRowid(this,e),r=r["".concat(t.fixed||"table","Body")]||r.tableBody;return r&&r.$el?r.$el.querySelector('.vxe-body--row[data-rowid="'.concat(e,'"] .').concat(t.id)):null}},funcs="setFilter,filter,clearFilter,getCheckedFilters,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,clearCopyCellArea,setCellAreas,openFind,openReplace,getMouseSelecteds,getMouseCheckeds,getSelectedCell,getSelectedRanges,clearCopyed,clearChecked,clearHeaderChecked,clearIndexChecked,clearSelected,insert,insertAt,remove,removeSelecteds,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,getActiveRow,hasActiveRow,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,exportCsv,openExport,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=Methods;